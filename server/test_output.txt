
> health-guard-server@1.0.0 test
> jest

  console.log
    ğŸ”§ è®¾ç½®æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:14:11)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆ›å»ºæˆåŠŸ

      at Object.log (test/setup.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

      at Object.log (test/setup.js:26:13)

  console.log
    ğŸ› ï¸ åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“...

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥æˆåŠŸ

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:25:17)

  console.log
    ğŸ”„ é‡ç½®æ•°æ®åº“è¡¨...

      at log (reset-tables.js:5:11)

  console.log
    âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

      at log (config/database.js:27:13)

  console.log
    ğŸ—‘ï¸ åˆ é™¤ç°æœ‰è¡¨...

      at log (reset-tables.js:15:13)

  console.log
    âœ… åˆ é™¤è¡¨ bookings

      at log (reset-tables.js:26:17)

  console.log
    âœ… åˆ é™¤è¡¨ addresses

      at log (reset-tables.js:26:17)

  console.log
    âœ… åˆ é™¤è¡¨ admin_sessions

      at log (reset-tables.js:26:17)

  console.log
    âœ… åˆ é™¤è¡¨ users

      at log (reset-tables.js:26:17)

  console.log
    ğŸ“‹ åˆ›å»ºæ–°è¡¨...

      at log (reset-tables.js:33:13)

  console.log
    âœ… åˆ›å»ºç”¨æˆ·è¡¨

      at log (reset-tables.js:56:13)

  console.log
    âœ… åˆ›å»ºåœ°å€è¡¨

      at log (reset-tables.js:76:13)

  console.log
    âœ… åˆ›å»ºé¢„çº¦è¡¨

      at log (reset-tables.js:98:13)

  console.log
    âœ… åˆ›å»ºç®¡ç†å‘˜ä¼šè¯è¡¨

      at log (reset-tables.js:110:13)

  console.log
    ğŸ‰ æ•°æ®åº“è¡¨é‡ç½®å®Œæˆ!

      at log (reset-tables.js:112:13)

  console.error
    æ•°æ®åº“æŸ¥è¯¢é”™è¯¯: Error: Duplicate entry 'constraint_test' for key 'users.open_id'
        at PromisePool.execute (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\mysql2\lib\promise\pool.js:54:22)
        at execute (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\config\database.js:39:31)
        at Function.query [as create] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\models\User.js:92:28)
        at Object.create (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\test\models\User.test.js:383:25)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      code: 'ER_DUP_ENTRY',
      errno: 1062,
      sql: '\n' +
        '      INSERT INTO users (\n' +
        '        open_id, nickname, avatar, phone, email, real_name,\n' +
        '        gender, birthday, status, member_level, service_count, total_spent,\n' +
        '        created_at, updated_at\n' +
        '      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n' +
        '    ',
      sqlState: '23000',
      sqlMessage: "Duplicate entry 'constraint_test' for key 'users.open_id'"
    }

    [0m [90m 40 |[39m     [36mreturn[39m rows[33m;[39m
     [90m 41 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 42 |[39m     console[33m.[39merror([32m'æ•°æ®åº“æŸ¥è¯¢é”™è¯¯:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 43 |[39m     [36mthrow[39m error[33m;[39m
     [90m 44 |[39m   }
     [90m 45 |[39m }[0m

      at error (config/database.js:42:13)
      at Function.create (models/User.js:92:22)
      at Object.<anonymous> (test/models/User.test.js:383:7)

  console.error
    åˆ›å»ºç”¨æˆ·å¤±è´¥: Error: Duplicate entry 'constraint_test' for key 'users.open_id'
        at PromisePool.execute (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\mysql2\lib\promise\pool.js:54:22)
        at execute (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\config\database.js:39:31)
        at Function.query [as create] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\models\User.js:92:28)
        at Object.create (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\test\models\User.test.js:383:25)
        at processTicksAndRejections (node:internal/process/task_queues:105:5) {
      code: 'ER_DUP_ENTRY',
      errno: 1062,
      sql: '\n' +
        '      INSERT INTO users (\n' +
        '        open_id, nickname, avatar, phone, email, real_name,\n' +
        '        gender, birthday, status, member_level, service_count, total_spent,\n' +
        '        created_at, updated_at\n' +
        '      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n' +
        '    ',
      sqlState: '23000',
      sqlMessage: "Duplicate entry 'constraint_test' for key 'users.open_id'"
    }

    [0m [90m 132 |[39m       }[33m;[39m
     [90m 133 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 134 |[39m       console[33m.[39merror([32m'åˆ›å»ºç”¨æˆ·å¤±è´¥:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 135 |[39m       [36mthrow[39m error[33m;[39m
     [90m 136 |[39m     }
     [90m 137 |[39m   }[0m

      at Function.error [as create] (models/User.js:134:15)
      at Object.<anonymous> (test/models/User.test.js:383:7)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®...

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:211:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:220:13)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:33:11)

FAIL test/models/User.test.js
  ç”¨æˆ·æ¨¡å‹æ•°æ®åº“æµ‹è¯•
    User.create - åˆ›å»ºç”¨æˆ·
      âˆš åº”è¯¥æˆåŠŸåˆ›å»ºæ–°ç”¨æˆ· (122 ms)
      âˆš åº”è¯¥è®¾ç½®é»˜è®¤å€¼ (121 ms)
      âˆš åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ (125 ms)
      âˆš åº”è¯¥æ­£ç¡®å¤„ç†ç‰¹æ®Šå­—ç¬¦ (110 ms)
    User.findByOpenId - æ ¹æ®OpenIdæŸ¥æ‰¾ç”¨æˆ·
      âˆš åº”è¯¥æˆåŠŸæ‰¾åˆ°å­˜åœ¨çš„ç”¨æˆ· (122 ms)
      âˆš åº”è¯¥è¿”å›nullå¯¹äºä¸å­˜åœ¨çš„openId (122 ms)
      âˆš åº”è¯¥æ­£ç¡®å¤„ç†æ•°æ®è„±æ• (114 ms)
    User.findById - æ ¹æ®IDæŸ¥æ‰¾ç”¨æˆ·
      âˆš åº”è¯¥æˆåŠŸæ‰¾åˆ°å­˜åœ¨çš„ç”¨æˆ· (116 ms)
      âˆš åº”è¯¥è¿”å›nullå¯¹äºä¸å­˜åœ¨çš„ID (118 ms)
      âˆš åº”è¯¥éªŒè¯IDå‚æ•°ç±»å‹ (115 ms)
    User.update - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      Ã— åº”è¯¥æˆåŠŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯ (126 ms)
      âˆš åº”è¯¥å¿½ç•¥ä¸å…è®¸æ›´æ–°çš„å­—æ®µ (123 ms)
      âˆš åº”è¯¥è¿”å›nullå¯¹äºä¸å­˜åœ¨çš„ç”¨æˆ· (115 ms)
      âˆš åº”è¯¥éªŒè¯æ‰‹æœºå·æ ¼å¼ (114 ms)
      âˆš åº”è¯¥éªŒè¯é‚®ç®±æ ¼å¼ (112 ms)
    User.updateStatus - æ›´æ–°ç”¨æˆ·çŠ¶æ€
      âˆš åº”è¯¥æˆåŠŸæ›´æ–°ç”¨æˆ·çŠ¶æ€ä¸ºç¦ç”¨ (123 ms)
      âˆš åº”è¯¥æˆåŠŸæ›´æ–°ç”¨æˆ·çŠ¶æ€ä¸ºæ¿€æ´» (130 ms)
      âˆš åº”è¯¥æ‹’ç»æ— æ•ˆçš„çŠ¶æ€å€¼ (115 ms)
      âˆš åº”è¯¥è¿”å›falseå¯¹äºä¸å­˜åœ¨çš„ç”¨æˆ· (115 ms)
    æ•°æ®å®Œæ•´æ€§éªŒè¯
      âˆš åˆ›å»ºç”¨æˆ·æ—¶åº”æ­£ç¡®è®¾ç½®æ‰€æœ‰æ—¶é—´æˆ³ (112 ms)
      Ã— æ›´æ–°ç”¨æˆ·æ—¶åº”æ­£ç¡®æ›´æ–°æ—¶é—´æˆ³ (220 ms)
      âˆš æ•°æ®åº“çº¦æŸåº”è¯¥æ­£ç¡®å·¥ä½œ (123 ms)
      âˆš åº”è¯¥æ­£ç¡®å¤„ç†NULLå€¼ (115 ms)

  â— ç”¨æˆ·æ¨¡å‹æ•°æ®åº“æµ‹è¯• â€º User.update - æ›´æ–°ç”¨æˆ·ä¿¡æ¯ â€º åº”è¯¥æˆåŠŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯

    expect(received).toBeGreaterThan(expected)

    Expected: > 1756217639000
    Received:   1756217639000

    [0m [90m 249 |[39m       [90m// éªŒè¯updated_atå­—æ®µå·²æ›´æ–°[39m
     [90m 250 |[39m       expect([36mnew[39m [33mDate[39m(dbUser[33m.[39mupdated_at))[33m.[39mtoBeInstanceOf([33mDate[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 251 |[39m       expect([36mnew[39m [33mDate[39m(dbUser[33m.[39mupdated_at)[33m.[39mgetTime())[33m.[39mtoBeGreaterThan(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 252 |[39m         [36mnew[39m [33mDate[39m(dbUser[33m.[39mcreated_at)[33m.[39mgetTime()
     [90m 253 |[39m       )[33m;[39m
     [90m 254 |[39m     })[33m;[39m[0m

      at Object.toBeGreaterThan (test/models/User.test.js:251:53)

  â— ç”¨æˆ·æ¨¡å‹æ•°æ®åº“æµ‹è¯• â€º æ•°æ®å®Œæ•´æ€§éªŒè¯ â€º æ›´æ–°ç”¨æˆ·æ—¶åº”æ­£ç¡®æ›´æ–°æ—¶é—´æˆ³

    expect(received).toBeGreaterThan(expected)

    Expected: > 1756217640302
    Received:   1756217640000

    [0m [90m 368 |[39m       [36mconst[39m updatedUser [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mupdate(user[33m.[39mid[33m,[39m { nickname[33m:[39m [32m'æ–°æ˜µç§°'[39m })[33m;[39m
     [90m 369 |[39m
    [31m[1m>[22m[39m[90m 370 |[39m       expect(updatedUser[33m.[39mupdatedAt[33m.[39mgetTime())[33m.[39mtoBeGreaterThan(user[33m.[39mcreatedAt[33m.[39mgetTime())[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 371 |[39m     })[33m;[39m
     [90m 372 |[39m
     [90m 373 |[39m     test([32m'æ•°æ®åº“çº¦æŸåº”è¯¥æ­£ç¡®å·¥ä½œ'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBeGreaterThan (test/models/User.test.js:370:47)

  console.log
    ğŸ”§ è®¾ç½®æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:14:11)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆ›å»ºæˆåŠŸ

      at Object.log (test/setup.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

      at Object.log (test/setup.js:26:13)

  console.log
    ğŸ› ï¸ åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“...

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥æˆåŠŸ

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:25:17)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®...

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:211:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:220:13)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:33:11)

PASS test/routes/booking.test.js
  æœåŠ¡é¢„çº¦æ¥å£æµ‹è¯•
    POST /api/bookings - åˆ›å»ºé¢„çº¦
      âˆš åº”è¯¥æˆåŠŸåˆ›å»ºæœåŠ¡é¢„çº¦ (72 ms)
      âˆš åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ (52 ms)
      âˆš åº”è¯¥éªŒè¯æœåŠ¡ç±»å‹ (41 ms)
      âˆš åº”è¯¥éªŒè¯é¢„çº¦æ—¥æœŸä¸èƒ½æ˜¯è¿‡å»æ—¶é—´ (37 ms)
      âˆš åº”è¯¥éªŒè¯åœ°å€å­˜åœ¨ä¸”å±äºå½“å‰ç”¨æˆ· (35 ms)
    GET /api/bookings - è·å–ç”¨æˆ·é¢„çº¦åˆ—è¡¨
      âˆš åº”è¯¥è¿”å›ç”¨æˆ·çš„é¢„çº¦åˆ—è¡¨ (43 ms)
      âˆš åº”è¯¥æ”¯æŒåˆ†é¡µåŠŸèƒ½ (55 ms)
      âˆš åº”è¯¥æ”¯æŒçŠ¶æ€ç­›é€‰ (49 ms)
      âˆš åº”è¯¥æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åˆ— (59 ms)
    GET /api/bookings/:id - è·å–é¢„çº¦è¯¦æƒ…
      âˆš åº”è¯¥è¿”å›é¢„çº¦è¯¦æƒ… (52 ms)
      âˆš åº”è¯¥æ‹’ç»è®¿é—®å…¶ä»–ç”¨æˆ·çš„é¢„çº¦ (57 ms)
      âˆš åº”è¯¥å¤„ç†ä¸å­˜åœ¨çš„é¢„çº¦ (52 ms)
    PUT /api/bookings/:id - æ›´æ–°é¢„çº¦
      âˆš åº”è¯¥æˆåŠŸæ›´æ–°é¢„çº¦ä¿¡æ¯ (63 ms)
      âˆš åº”è¯¥æ‹’ç»æ›´æ–°å·²å®Œæˆçš„é¢„çº¦ (50 ms)
      âˆš åº”è¯¥æ‹’ç»è®¿é—®å…¶ä»–ç”¨æˆ·çš„é¢„çº¦ (58 ms)
    PUT /api/bookings/:id/cancel - å–æ¶ˆé¢„çº¦
      âˆš åº”è¯¥æˆåŠŸå–æ¶ˆé¢„çº¦ (54 ms)
      âˆš åº”è¯¥æ‹’ç»å–æ¶ˆå·²å®Œæˆçš„é¢„çº¦ (56 ms)
      âˆš åº”è¯¥æ‹’ç»å–æ¶ˆå·²å–æ¶ˆçš„é¢„çº¦ (55 ms)
    GET /api/services - è·å–æœåŠ¡ç±»å‹åˆ—è¡¨
      âˆš åº”è¯¥è¿”å›å¯ç”¨çš„æœåŠ¡ç±»å‹ (45 ms)
      âˆš æœåŠ¡ä¿¡æ¯åº”è¯¥åŒ…å«ä»·æ ¼å’Œæ—¶é•¿ (40 ms)
    æ•°æ®åº“æ•°æ®éªŒè¯
      âˆš é¢„çº¦åˆ›å»ºæ—¶åº”æ­£ç¡®è®¡ç®—è´¹ç”¨ (39 ms)
      âˆš é¢„çº¦çŠ¶æ€å˜æ›´åº”æ­£ç¡®è®°å½•æ—¶é—´ (155 ms)
      âˆš é¢„çº¦å’Œåœ°å€çš„å…³è”åº”è¯¥æ­£ç¡® (49 ms)
      âˆš é¢„çº¦ç»Ÿè®¡æ•°æ®åº”è¯¥å‡†ç¡® (49 ms)

  console.log
    ğŸ”§ è®¾ç½®æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:14:11)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆ›å»ºæˆåŠŸ

      at Object.log (test/setup.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

      at Object.log (test/setup.js:26:13)

  console.log
    ğŸ› ï¸ åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“...

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥æˆåŠŸ

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:25:17)

  console.log
    åˆ†é¡µå‚æ•°: { pageNum: 1, pageSizeNum: 20, limitNum: 20, offsetNum: 0 }

      at Function.log [as getList] (models/User.js:260:15)

  console.log
    æ‰§è¡ŒæŸ¥è¯¢ SQL: 
            SELECT 
              id, nickname, real_name, phone, email, avatar, status, member_level,
              service_count, total_spent, created_at, updated_at
            FROM users 
             
            ORDER BY created_at DESC 
            LIMIT 20 OFFSET 0

      at Function.log [as getList] (models/User.js:278:15)

  console.log
    æŸ¥è¯¢å‚æ•°: []

      at Function.log [as getList] (models/User.js:279:15)

  console.error
    ç®¡ç†å‘˜è®¤è¯å¤±è´¥: Error: ç®¡ç†å‘˜ç™»å½•å·²è¿‡æœŸ
        at Function.verifyAdminToken (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\utils\jwt.js:47:15)
        at verifyAdminToken (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\middlewares\auth.js:44:30)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\route.js:149:13)
        at Route.dispatch (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\route.js:119:3)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:284:15
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:175:3)
        at router (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:47:12)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at urlencodedParser (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\body-parser\lib\types\urlencoded.js:94:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at jsonParser (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\body-parser\lib\types\json.js:113:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at cors (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:188:7)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:224:17
        at originCallback (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:214:15)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:219:13
        at optionsCallback (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:199:9)
        at corsMiddleware (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:204:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at expressInit (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\middleware\init.js:40:5)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at query (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\middleware\query.js:45:5)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:175:3)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\application.js:181:10)
        at Server.app (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\express.js:39:9)
        at Server.emit (node:events:518:28)
        at parserOnIncoming (node:_http_server:1153:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 58 |[39m     next()[33m;[39m
     [90m 59 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 60 |[39m     console[33m.[39merror([32m'ç®¡ç†å‘˜è®¤è¯å¤±è´¥:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 61 |[39m     [33mUtils[39m[33m.[39merror(res[33m,[39m error[33m.[39mmessage[33m,[39m [35m401[39m)[33m;[39m
     [90m 62 |[39m   }
     [90m 63 |[39m }[33m;[39m[0m

      at error (middlewares/auth.js:60:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:94:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    ç®¡ç†å‘˜è®¤è¯å¤±è´¥: Error: invalid token
        at Function.verifyAdminToken (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\utils\jwt.js:49:13)
        at verifyAdminToken (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\middlewares\auth.js:44:30)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\route.js:149:13)
        at Route.dispatch (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\route.js:119:3)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:284:15
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:175:3)
        at router (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:47:12)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at urlencodedParser (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\body-parser\lib\types\urlencoded.js:94:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at jsonParser (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\body-parser\lib\types\json.js:113:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at cors (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:188:7)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:224:17
        at originCallback (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:214:15)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:219:13
        at optionsCallback (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:199:9)
        at corsMiddleware (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:204:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at expressInit (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\middleware\init.js:40:5)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at query (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\middleware\query.js:45:5)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:175:3)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\application.js:181:10)
        at Server.app (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\express.js:39:9)
        at Server.emit (node:events:518:28)
        at parserOnIncoming (node:_http_server:1153:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 58 |[39m     next()[33m;[39m
     [90m 59 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 60 |[39m     console[33m.[39merror([32m'ç®¡ç†å‘˜è®¤è¯å¤±è´¥:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 61 |[39m     [33mUtils[39m[33m.[39merror(res[33m,[39m error[33m.[39mmessage[33m,[39m [35m401[39m)[33m;[39m
     [90m 62 |[39m   }
     [90m 63 |[39m }[33m;[39m[0m

      at error (middlewares/auth.js:60:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:94:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®...

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:211:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:220:13)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:33:11)

PASS test/routes/admin.test.js
  ç®¡ç†å‘˜åŠŸèƒ½æ¥å£æµ‹è¯•
    POST /api/admin/login - ç®¡ç†å‘˜ç™»å½•
      âˆš åº”è¯¥ä½¿ç”¨æ­£ç¡®å¯†ç æˆåŠŸç™»å½• (56 ms)
      âˆš åº”è¯¥æ‹’ç»é”™è¯¯çš„å¯†ç  (35 ms)
      âˆš åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ (37 ms)
      âˆš åº”è¯¥è®¾ç½®æ­£ç¡®çš„è¿‡æœŸæ—¶é—´ (40 ms)
    GET /api/admin/users - è·å–ç”¨æˆ·åˆ—è¡¨
      âˆš åº”è¯¥è¿”å›æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ (45 ms)
    GET /api/admin/users/:id - è·å–ç”¨æˆ·è¯¦æƒ…
      âˆš åº”è¯¥è¿”å›ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ (38 ms)
      âˆš åº”è¯¥è¿”å›ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ (49 ms)
      âˆš åº”è¯¥å¤„ç†ä¸å­˜åœ¨çš„ç”¨æˆ· (43 ms)
    PUT /api/admin/users/:id/status - æ›´æ–°ç”¨æˆ·çŠ¶æ€
      âˆš åº”è¯¥æˆåŠŸç¦ç”¨ç”¨æˆ· (59 ms)
      âˆš åº”è¯¥æˆåŠŸå¯ç”¨ç”¨æˆ· (61 ms)
      âˆš åº”è¯¥éªŒè¯çŠ¶æ€å€¼ (39 ms)
    GET /api/admin/statistics - è·å–ç®¡ç†ç»Ÿè®¡ä¿¡æ¯
      âˆš åº”è¯¥è¿”å›ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ (52 ms)
    POST /api/admin/logout - ç®¡ç†å‘˜ç™»å‡º
      âˆš åº”è¯¥æˆåŠŸç™»å‡ºç®¡ç†å‘˜ (48 ms)
    ç®¡ç†å‘˜æƒé™éªŒè¯
      âˆš è¿‡æœŸçš„tokenåº”è¯¥è¢«æ‹’ç» (54 ms)
      âˆš æ— æ•ˆæ ¼å¼çš„tokenåº”è¯¥è¢«æ‹’ç» (43 ms)
    æ•°æ®åº“æ•°æ®éªŒè¯
      âˆš ç®¡ç†å‘˜ç™»å½•åº”è¯¥åˆ›å»ºsessionè®°å½• (41 ms)
      âˆš ç”¨æˆ·çŠ¶æ€æ›´æ–°åº”è¯¥æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“ (160 ms)
      âˆš ç®¡ç†å‘˜ç™»å‡ºåº”è¯¥åˆ é™¤sessionè®°å½• (55 ms)

  console.log
    ğŸ”§ è®¾ç½®æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:14:11)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆ›å»ºæˆåŠŸ

      at Object.log (test/setup.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ

      at Object.log (test/setup.js:26:13)

  console.log
    ğŸ› ï¸ åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“...

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:19:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥æˆåŠŸ

      at TestHelper.log [as setupTestDatabase] (test/helpers/TestHelper.js:25:17)

  console.error
    ç”¨æˆ·è®¤è¯å¤±è´¥: Error: Tokenæ— æ•ˆ
        at Function.verifyUserToken (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\utils\jwt.js:34:13)
        at verifyUserToken (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\middlewares\auth.js:15:30)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\route.js:149:13)
        at Route.dispatch (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\route.js:119:3)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:284:15
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:175:3)
        at router (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:47:12)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at urlencodedParser (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\body-parser\lib\types\urlencoded.js:94:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at jsonParser (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\body-parser\lib\types\json.js:113:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at cors (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:188:7)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:224:17
        at originCallback (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:214:15)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:219:13
        at optionsCallback (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:199:9)
        at corsMiddleware (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\cors\lib\index.js:204:7)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at expressInit (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\middleware\init.js:40:5)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at query (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\middleware\query.js:45:5)
        at Layer.handle [as handle_request] (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\layer.js:95:5)
        at trim_prefix (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:328:13)
        at D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:286:9
        at Function.process_params (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:346:12)
        at next (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:280:10)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\router\index.js:175:3)
        at Function.handle (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\application.js:181:10)
        at Server.app (D:\ProjectPackage\claude_code_project\RedCellProject\wx_mini_program\server\node_modules\express\lib\express.js:39:9)
        at Server.emit (node:events:518:28)
        at parserOnIncoming (node:_http_server:1153:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 27 |[39m     next()[33m;[39m
     [90m 28 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 29 |[39m     console[33m.[39merror([32m'ç”¨æˆ·è®¤è¯å¤±è´¥:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 30 |[39m     [33mUtils[39m[33m.[39merror(res[33m,[39m [32m'tokenæ— æ•ˆ'[39m[33m,[39m [35m401[39m)[33m;[39m
     [90m 31 |[39m   }
     [90m 32 |[39m }[33m;[39m[0m

      at error (middlewares/auth.js:29:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:94:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)
      at node_modules/cors/lib/index.js:219:13
      at optionsCallback (node_modules/cors/lib/index.js:199:9)
      at corsMiddleware (node_modules/cors/lib/index.js:204:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®...

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:211:13)

  console.log
    âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ

      at TestHelper.log [as cleanup] (test/helpers/TestHelper.js:220:13)

  console.log
    ğŸ§¹ æ¸…ç†æµ‹è¯•ç¯å¢ƒ...

      at Object.log (test/setup.js:33:11)

PASS test/routes/auth.test.js
  ç”¨æˆ·è®¤è¯æ¥å£æµ‹è¯•
    POST /api/auth/register - ç”¨æˆ·æ³¨å†Œ
      âˆš åº”è¯¥æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ· (28 ms)
      âˆš åº”è¯¥æ‹’ç»é‡å¤çš„openIdæ³¨å†Œ (27 ms)
      âˆš åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ (16 ms)
    POST /api/auth/login - ç”¨æˆ·ç™»å½•
      âˆš åº”è¯¥æˆåŠŸç™»å½•ç°æœ‰ç”¨æˆ· (25 ms)
      âˆš åº”è¯¥ä¸ºæ–°ç”¨æˆ·åˆ›å»ºè´¦æˆ· (26 ms)
    GET /api/auth/profile - è·å–ç”¨æˆ·ä¿¡æ¯
      âˆš åº”è¯¥è¿”å›ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ (21 ms)
      âˆš åº”è¯¥æ‹’ç»æ— æ•ˆtokençš„è¯·æ±‚ (29 ms)
      âˆš åº”è¯¥æ‹’ç»æ— tokençš„è¯·æ±‚ (19 ms)
    PUT /api/auth/profile - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      âˆš åº”è¯¥æˆåŠŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯ (31 ms)
      âˆš åº”è¯¥éªŒè¯æ‰‹æœºå·æ ¼å¼ (25 ms)
      âˆš åº”è¯¥éªŒè¯é‚®ç®±æ ¼å¼ (25 ms)
    POST /api/auth/logout - ç”¨æˆ·ç™»å‡º
      âˆš åº”è¯¥æˆåŠŸç™»å‡ºç”¨æˆ· (24 ms)
      âˆš åº”è¯¥æ‹’ç»æ— tokençš„ç™»å‡ºè¯·æ±‚ (20 ms)
    æ•°æ®åº“æ•°æ®éªŒè¯
      âˆš ç”¨æˆ·æ³¨å†Œæ—¶åº”æ­£ç¡®ä¿å­˜æ‰€æœ‰å­—æ®µ (24 ms)
      âˆš ç”¨æˆ·æ›´æ–°æ—¶åº”æ­£ç¡®ä¿®æ”¹æ•°æ®åº“è®°å½• (141 ms)

Test Suites: 1 failed, 3 passed, 4 total
Tests:       2 failed, 78 passed, 80 total
Snapshots:   0 total
Time:        7.292 s
Ran all test suites.
