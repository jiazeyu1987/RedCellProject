<!--index.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<navigation-bar title="å·¥ä½œå°" back="{{false}}" color="white" background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"></navigation-bar>

<!-- ä¸»å†…å®¹åŒºåŸŸ -->
<scroll-view class="scrollarea" scroll-y type="list" refresher-enabled="{{true}}" bindrefresherrefresh="onRefresh" refresher-triggered="{{refreshing}}">
  <view class="home-container">
    
    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
    <view class="header-section">
      <view class="user-info">
        <image class="user-avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="cover"></image>
        <view class="user-details">
          <text class="user-name">{{userInfo.nickName || 'è®°å½•å‘˜'}}</text>
          <view class="user-status" bindtap="onWorkStatusTap">
            <text class="status-dot status-{{workStatus}}"></text>
            <text class="status-text">{{statusText}}</text>
            <text class="status-arrow">â–¸</text>
          </view>
        </view>
      </view>
      <view class="header-actions">
        <view class="notification-icon" bindtap="onNotificationTap">
          <text class="icon-bell">ğŸ””</text>
          <text wx:if="{{unreadCount > 0}}" class="notification-badge">{{unreadCount}}</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥ä»»åŠ¡æ¦‚è§ˆ -->
    <card title="ä»Šæ—¥ä»»åŠ¡" subtitle="{{todayTasksSubtitle}}" extra="{{true}}" clickable="{{true}}" bind:cardclick="onTodayTasksTap">
      <view slot="extra" class="card-extra-text" bindtap="onTodayTasksTap">æŸ¥çœ‹å…¨éƒ¨</view>
      <view class="tasks-overview">
        <view class="task-stat">
          <text class="stat-number">{{todayTasks.total}}</text>
          <text class="stat-label">æ€»ä»»åŠ¡</text>
        </view>
        <view class="task-stat">
          <text class="stat-number">{{todayTasks.pending}}</text>
          <text class="stat-label">å¾…å®Œæˆ</text>
        </view>
        <view class="task-stat">
          <text class="stat-number">{{todayTasks.completed}}</text>
          <text class="stat-label">å·²å®Œæˆ</text>
        </view>
      </view>
      
      <!-- ç´§æ€¥ä»»åŠ¡åˆ—è¡¨ -->
      <view wx:if="{{urgentTasks.length > 0}}" class="urgent-tasks">
        <text class="urgent-title">ç´§æ€¥ä»»åŠ¡</text>
        <view wx:for="{{urgentTasks}}" wx:key="id" class="urgent-task-item" bindtap="onTaskItemTap" data-task="{{item}}">
          <text class="urgent-time">{{item.time}}</text>
          <text class="urgent-patient">{{item.patientName}}</text>
          <text class="urgent-service">{{item.serviceName}}</text>
        </view>
      </view>
    </card>

    <!-- æœ¬å‘¨ç»Ÿè®¡ -->
    <card title="æœ¬å‘¨ç»Ÿè®¡" subtitle="{{weekStatsSubtitle}}" type="bordered">
      <view class="week-stats">
        <view class="stat-item">
          <text class="stat-icon">ğŸ“Š</text>
          <view class="stat-content">
            <text class="stat-value">{{weekStats.serviceCount}}</text>
            <text class="stat-desc">æœåŠ¡æ¬¡æ•°</text>
          </view>
        </view>
        <view class="stat-item">
          <text class="stat-icon">â±ï¸</text>
          <view class="stat-content">
            <text class="stat-value">{{weekStats.totalHours}}</text>
            <text class="stat-desc">æœåŠ¡æ—¶é•¿</text>
          </view>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ’°</text>
          <view class="stat-content">
            <text class="stat-value">Â¥{{weekStats.income}}</text>
            <text class="stat-desc">æœ¬å‘¨æ”¶å…¥</text>
          </view>
        </view>
      </view>
    </card>

    <!-- å¿«æ·æ“ä½œåŒºåŸŸ -->
    <card title="å¿«æ·æ“ä½œ" showFooter="{{false}}">
      <view class="quick-actions">
        <view class="action-item" bindtap="onQuickAction" data-action="startService">
          <text class="action-icon">ğŸ¥</text>
          <text class="action-label">å¼€å§‹æœåŠ¡</text>
        </view>
        <view class="action-item" bindtap="onQuickAction" data-action="patientFiles">
          <text class="action-icon">ğŸ‘¥</text>
          <text class="action-label">æ‚£è€…æ¡£æ¡ˆ</text>
        </view>
        <view class="action-item" bindtap="onQuickAction" data-action="schedule">
          <text class="action-icon">ğŸ“…</text>
          <text class="action-label">æ—¥ç¨‹ç®¡ç†</text>
        </view>
        <view class="action-item" bindtap="onQuickAction" data-action="payment">
          <text class="action-icon">ğŸ’³</text>
          <text class="action-label">ä»˜æ¬¾ç®¡ç†</text>
        </view>
      </view>
    </card>

    <!-- ç´§æ€¥é€šçŸ¥åŒºåŸŸ -->
    <card wx:if="{{notices.length > 0}}" title="ç´§æ€¥é€šçŸ¥" type="shadow-none" extraClass="notice-card">
      <view class="notices-list">
        <view wx:for="{{notices}}" wx:key="id" class="notice-item notice-{{item.type}}" bindtap="onNoticeTap" data-notice="{{item}}">
          <text class="notice-icon">{{item.icon}}</text>
          <view class="notice-content">
            <text class="notice-title">{{item.title}}</text>
            <text class="notice-desc">{{item.description}}</text>
            <text class="notice-time">{{item.time}}</text>
          </view>
          <text class="notice-arrow">></text>
        </view>
      </view>
    </card>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="bottom-safe-area"></view>
  </view>
</scroll-view>
