<!--pages/index/index.wxml-->
<view class="index-container">
  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-header">
    <view class="avatar-container">
      <image 
        class="avatar" 
        src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}"
        mode="aspectFill"
      />
    </view>
    <view class="user-info">
      <text class="nickname">{{userInfo.nickName || 'è®°å½•å‘˜'}}</text>
      <view class="status-container">
        <text class="status {{workStatus}}">{{statusText}}</text>
        <view class="status-dot {{workStatus}}"></view>
      </view>
    </view>
    <view class="notification-icon" bind:tap="goToNotifications">
      <text class="icon">ğŸ””</text>
      <view class="badge" wx:if="{{unreadCount > 0}}">{{unreadCount > 99 ? '99+' : unreadCount}}</view>
    </view>
  </view>

  <!-- ä»Šæ—¥ä»»åŠ¡å¡ç‰‡ -->
  <view class="task-card">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥ä»»åŠ¡</text>
      <text class="card-subtitle">{{todayTasksSubtitle}}</text>
    </view>
    <view class="task-stats">
      <view class="stat-item">
        <text class="stat-number">{{todayTasks.total}}</text>
        <text class="stat-label">æ€»è®¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number pending">{{todayTasks.pending}}</text>
        <text class="stat-label">å¾…å®Œæˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number completed">{{todayTasks.completed}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- ç´§æ€¥ä»»åŠ¡åˆ—è¡¨ -->
  <view class="urgent-tasks" wx:if="{{urgentTasks.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸš¨ ç´§æ€¥ä»»åŠ¡</text>
    </view>
    <view class="task-list">
      <view 
        class="task-item" 
        wx:for="{{urgentTasks}}" 
        wx:key="id"
        bind:tap="goToTaskDetail"
        data-id="{{item.id}}"
      >
        <view class="task-time">{{item.time}}</view>
        <view class="task-content">
          <text class="patient-name">{{item.patientName}}</text>
          <text class="service-name">{{item.serviceName}}</text>
        </view>
        <view class="task-arrow">â–¶</view>
      </view>
    </view>
  </view>

  <!-- æœ¬å‘¨ç»Ÿè®¡ -->
  <view class="week-stats">
    <view class="card-header">
      <text class="card-title">æœ¬å‘¨ç»Ÿè®¡</text>
      <text class="card-subtitle">{{weekStatsSubtitle}}</text>
    </view>
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-value">{{weekStats.serviceCount}}</text>
        <text class="stat-label">æœåŠ¡æ¬¡æ•°</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{weekStats.totalHours}}</text>
        <text class="stat-label">æœåŠ¡æ—¶é•¿</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">ï¿¥{{weekStats.income}}</text>
        <text class="stat-label">æ”¶å…¥</text>
      </view>
    </view>
  </view>

  <!-- é€šçŸ¥æ¶ˆæ¯ -->
  <view class="notices" wx:if="{{notices.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ“¢ æ¶ˆæ¯é€šçŸ¥</text>
      <text class="see-all" bind:tap="goToNotifications">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="notice-list">
      <view 
        class="notice-item" 
        wx:for="{{notices}}" 
        wx:key="id"
        bind:tap="goToNoticeDetail"
        data-id="{{item.id}}"
      >
        <view class="notice-icon">{{item.icon}}</view>
        <view class="notice-content">
          <text class="notice-title">{{item.title}}</text>
          <text class="notice-desc">{{item.description}}</text>
          <text class="notice-time">{{item.time}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
  <view class="quick-actions">
    <view class="action-button" bindtap="goToSchedule">
      <text class="action-icon">ğŸ“…</text>
      <text class="action-text">æ—¥ç¨‹ç®¡ç†</text>
    </view>
    <view class="action-button" bindtap="goToPatients">
      <text class="action-icon">ğŸ‘¥</text>
      <text class="action-text">æ‚£è€…ç®¡ç†</text>
    </view>
    <view class="action-button" bindtap="goToSettings">
      <text class="action-icon">âš™ï¸</text>
      <text class="action-text">è®¾ç½®</text>
    </view>
  </view>
</view>

<!-- ä¸‹æ‹‰åˆ·æ–°æç¤º -->
<view class="refresh-tip" wx:if="{{refreshing}}">
  æ­£åœ¨åˆ·æ–°...
</view>