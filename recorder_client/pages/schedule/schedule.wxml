<view class="schedule-page">
  <!-- å¯¼èˆªæ  -->
  <navigation-bar 
    title="æ—¥ç¨‹ç®¡ç†"
    show-back="{{false}}"
    background="#fff">
    <view slot="right" class="nav-actions">
      <!-- å®¡æ‰¹ç®¡ç†æŒ‰é’® -->
      <view wx:if="{{approvalManagement.hasApprovalPermission}}" 
            class="nav-btn approval-btn" 
            bindtap="openApprovalManager">
        <text class="nav-icon">ğŸ“‹</text>
        <view wx:if="{{approvalManagement.pendingCount > 0}}" class="approval-badge">{{approvalManagement.pendingCount}}</view>
      </view>
      
      <!-- ç­›é€‰æŒ‰é’® -->
      <view class="nav-btn" bindtap="showFilter">
        <text class="nav-icon">ğŸ”</text>
        <text wx:if="{{currentFilters.keyword || currentFilters.status !== 'all'}}" class="filter-dot"></text>
      </view>
    </view>
  </navigation-bar>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content">
    
    <!-- ç­‰å¾…æ‚£è€…æç¤ºæ¡ -->
    <view wx:if="{{waitingForPatient.isWaiting}}" class="waiting-patient-bar">
      <view class="waiting-info">
        <text class="waiting-icon">â³</text>
        <view class="waiting-text">
          <text class="waiting-title">æ­£åœ¨ç­‰å¾…æ‚£è€…...</text>
          <text class="waiting-time">å‰©ä½™æ—¶é—´: {{Math.floor(waitingForPatient.remainingTime / 60)}}åˆ†{{waitingForPatient.remainingTime % 60}}ç§’</text>
        </view>
      </view>
      <view class="waiting-actions">
        <view class="waiting-btn arrived" bindtap="patientArrivedFromButton" data-schedule-id="{{waitingForPatient.scheduleId}}">
          <text class="btn-text">æ‚£è€…å·²åˆ°</text>
        </view>
        <view class="waiting-btn stop" bindtap="stopWaiting">
          <text class="btn-text">åœæ­¢ç­‰å¾…</text>
        </view>
      </view>
    </view>
    
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="statistics-section">
      <!-- ä¸»è¦ç»Ÿè®¡ -->
      <view class="stats-main-grid">
        <view class="stat-item main-stat" bindtap="onStatItemTap" data-type="total">
          <view class="stat-content">
            <text class="stat-number animated">{{statistics.total}}</text>
            <view class="stat-info">
              <text class="stat-label">æ€»æ—¥ç¨‹</text>
              <view wx:if="{{statistics.trend.percentage > 0}}" class="stat-trend {{statistics.trend.direction}}">
                <text class="trend-icon">{{statistics.trend.direction === 'up' ? 'â†‘' : statistics.trend.direction === 'down' ? 'â†“' : 'â†’'}}</text>
                <text class="trend-text">{{statistics.trend.percentage}}%</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="stat-item" bindtap="onStatItemTap" data-type="today">
          <text class="stat-number today-number animated">{{statistics.today}}</text>
          <text class="stat-label">ä»Šæ—¥</text>
          <view wx:if="{{statistics.today > 0}}" class="stat-badge today-badge">æœ‰å®‰æ’</view>
        </view>
        
        <view class="stat-item" bindtap="onStatItemTap" data-type="pending">
          <text class="stat-number pending-number animated">{{statistics.pending}}</text>
          <text class="stat-label">å¾…æœåŠ¡</text>
          <view wx:if="{{statistics.pending > 0}}" class="stat-badge pending-badge">æ€¥éœ€å¤„ç†</view>
        </view>
        
        <view class="stat-item" bindtap="onStatItemTap" data-type="overdue">
          <text class="stat-number overdue-number animated">{{statistics.overdue}}</text>
          <text class="stat-label">å·²è¿‡æœŸ</text>
          <view wx:if="{{statistics.overdue > 0}}" class="stat-badge overdue-badge">éœ€å…³æ³¨</view>
        </view>
      </view>
      
      <!-- è¯¦ç»†ç»Ÿè®¡ -->
      <view class="stats-detail-section">
        <view class="stats-detail-grid">
          <view class="detail-stat-item">
            <text class="detail-stat-number">{{statistics.completionRate}}%</text>
            <text class="detail-stat-label">å®Œæˆç‡</text>
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{statistics.completionRate}}%"></view>
            </view>
          </view>
          
          <view class="detail-stat-item">
            <text class="detail-stat-number">{{statistics.avgDuration}}</text>
            <text class="detail-stat-label">å¹³å‡æ—¶é•¿(åˆ†)</text>
          </view>
          
          <view class="detail-stat-item">
            <text class="detail-stat-number">{{statistics.thisWeek}}</text>
            <text class="detail-stat-label">æœ¬å‘¨æ€»æ•°</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·ç­›é€‰ -->
    <view class="quick-filters-section">
      <scroll-view class="quick-filters-scroll" scroll-x="{{true}}" show-scrollbar="{{false}}">
        <view class="quick-filters-list">
          <view wx:for="{{quickFilters}}" wx:key="key"
                class="quick-filter-item {{((item.key === 'today' && currentFilters.time === 'today') || (item.key === 'pending' && currentFilters.status === 'pending') || (item.key === 'urgent' && currentFilters.priority === 'urgent') || (item.key === 'overdue' && currentFilters.time === 'overdue')) ? 'active' : ''}}"
                data-key="{{item.key}}"
                bindtap="onQuickFilter">
            <text class="filter-icon">{{item.icon}}</text>
            <text class="filter-label">{{item.label}}</text>
            <view wx:if="{{item.count > 0}}" 
                  class="filter-count {{item.countChanged ? 'animate-in' : ''}}">{{item.count}}</view>
          </view>
          
          <!-- æ¸…é™¤ç­›é€‰æŒ‰é’® -->
          <view wx:if="{{currentFilters.time !== 'all' || currentFilters.status !== 'all' || currentFilters.priority !== 'all' || currentFilters.keyword}}"
                class="quick-filter-item clear-filter"
                bindtap="clearFilters">
            <text class="filter-icon">âŒ</text>
            <text class="filter-label">æ¸…é™¤</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ—¥ç¨‹åˆ—è¡¨ -->
    <view class="schedule-list-section">
      <!-- åˆ—è¡¨å¤´éƒ¨æ“ä½œ -->
      <view class="list-header">
        <view class="list-info">
          <text class="list-count">å…± {{filteredScheduleList.length}} æ¡æ—¥ç¨‹</text>
          <text wx:if="{{currentFilters.sort !== 'time_asc'}}" class="sort-info">
            æŒ‰{{currentFilters.sort === 'time_desc' ? 'æ—¶é—´é™åº' : currentFilters.sort === 'priority_desc' ? 'ä¼˜å…ˆçº§' : 'çŠ¶æ€'}}æ’åº
          </text>
        </view>
        
        <view class="list-actions">
          <view class="action-btn" bindtap="toggleBatchMode">
            <text class="action-icon">{{batchMode ? 'âœ“' : 'â˜‘ï¸'}}</text>
            <text class="action-text">{{batchMode ? 'å®Œæˆ' : 'æ‰¹é‡'}}</text>
          </view>
          <view wx:if="{{batchMode}}" class="action-btn quick-select-btn" bindtap="showBatchQuickMenu">
            <text class="action-icon">âš¡</text>
            <text class="action-text">å¿«é€‰</text>
          </view>
        </view>
      </view>
      
      <!-- æ‰¹é‡é€‰æ‹©æ“ä½œæ  -->
      <view wx:if="{{batchMode}}" class="batch-selection-bar">
        <!-- é€‰æ‹©ä¿¡æ¯æ˜¾ç¤º -->
        <view class="selection-info">
          <view class="selection-main-info">
            <text class="selected-count">
              {{selectedSchedules.length > 0 ? 'å·²é€‰æ‹© ' + selectedSchedules.length + ' / ' + filteredScheduleList.length : 'è¯·é€‰æ‹©é¡¹ç›®'}}
            </text>
            <view wx:if="{{selectedSchedules.length > 0}}" class="selection-progress-wrapper">
              <view class="selection-progress-bar">
                <view class="selection-progress-fill" 
                      style="width: {{Math.round(selectedSchedules.length / filteredScheduleList.length * 100)}}%"></view>
              </view>
              <text class="selection-percentage">{{Math.round(selectedSchedules.length / filteredScheduleList.length * 100)}}%</text>
            </view>
          </view>
          
          <!-- æœ€åæ“ä½œæ˜¾ç¤º -->
          <view wx:if="{{batchSelection.lastSelectAction}}" class="last-action">
            <text class="last-action-text">æœ€åæ“ä½œï¼š{{batchSelection.lastSelectAction}}</text>
          </view>
        </view>
        
        <!-- é€‰æ‹©æ“ä½œæŒ‰é’® -->
        <view class="selection-actions">
          <view class="selection-btn {{selectedSchedules.length === filteredScheduleList.length ? 'all-selected' : ''}}" 
                bindtap="selectAll">
            <text class="selection-icon">{{selectedSchedules.length === filteredScheduleList.length ? 'âœ“' : 'â˜‘ï¸'}}</text>
            <text class="selection-text">{{selectedSchedules.length === filteredScheduleList.length ? 'å·²å…¨é€‰' : 'å…¨é€‰'}}</text>
            <view wx:if="{{selectedSchedules.length > 0 && selectedSchedules.length < filteredScheduleList.length}}" 
                  class="selection-counter">{{filteredScheduleList.length - selectedSchedules.length}}</view>
          </view>
          
          <view class="selection-btn {{selectedSchedules.length === 0 ? 'disabled' : ''}}" 
                bindtap="selectInverse">
            <text class="selection-icon">ğŸ”„</text>
            <text class="selection-text">åé€‰</text>
          </view>
          
          <view class="selection-btn {{selectedSchedules.length === 0 ? 'disabled' : ''}}" 
                bindtap="clearSelection">
            <text class="selection-icon">âŒ</text>
            <text class="selection-text">æ¸…ç©º</text>
          </view>
        </view>
      </view>
      
      <!-- å¿«é€Ÿé€‰æ‹©èœå• -->
      <view wx:if="{{batchMode && batchSelection.showQuickSelectMenu}}" class="quick-select-menu">
        <view class="quick-select-header">
          <text class="menu-title">ğŸš€ å¿«é€Ÿé€‰æ‹©</text>
          <view class="menu-close" bindtap="showBatchQuickMenu">
            <text class="close-icon">âŒ</text>
          </view>
        </view>
        
        <!-- å¿«é€Ÿé€‰æ‹©é€‰é¡¹ -->
        <view class="quick-select-options">
          <view class="quick-option-group">
            <text class="group-title">æŒ‰æ—¶é—´é€‰æ‹©</text>
            <view class="option-list">
              <view class="quick-option" data-action="select_today" bindtap="quickSelectAction">
                <text class="option-icon">ğŸ“…</text>
                <text class="option-text">ä»Šæ—¥é¢„çº¦</text>
                <view class="option-count">{{todayScheduleCount}}</view>
              </view>
            </view>
          </view>
          
          <view class="quick-option-group">
            <text class="group-title">æŒ‰çŠ¶æ€é€‰æ‹©</text>
            <view class="option-list">
              <view class="quick-option" data-action="select_pending" bindtap="quickSelectAction">
                <text class="option-icon">â³</text>
                <text class="option-text">å¾…å¤„ç†</text>
                <view class="option-count">{{pendingScheduleCount}}</view>
              </view>
              <view class="quick-option" data-action="select_urgent" bindtap="quickSelectAction">
                <text class="option-icon">ğŸ”¥</text>
                <text class="option-text">ç´§æ€¥é¡¹ç›®</text>
                <view class="option-count">{{urgentScheduleCount}}</view>
              </view>
              <view class="quick-option" data-action="select_overdue" bindtap="quickSelectAction">
                <text class="option-icon">âš ï¸</text>
                <text class="option-text">å·²è¿‡æœŸ</text>
                <view class="option-count">0</view>
              </view>
            </view>
          </view>
          
          <view class="quick-option-group">
            <text class="group-title">æŒ‰æ•°é‡é€‰æ‹©</text>
            <view class="option-list">
              <view class="quick-option" data-action="select_first_10" bindtap="quickSelectAction">
                <text class="option-icon">ğŸ”</text>
                <text class="option-text">å‰10ä¸ª</text>
                <view class="option-count">{{first10Count}}</view>
              </view>
              <view class="quick-option" data-action="select_range_5" bindtap="quickSelectAction">
                <text class="option-icon">ğŸ¯</text>
                <text class="option-text">ä¸­é—´5ä¸ª</text>
                <view class="option-count">{{middle5Count}}</view>
              </view>
              <view class="quick-option" data-action="select_last_10" bindtap="quickSelectAction">
                <text class="option-icon">ğŸ”Ÿ</text>
                <text class="option-text">å10ä¸ª</text>
                <view class="option-count">{{last10Count}}</view>
              </view>
            </view>
          </view>
          
          <!-- é«˜çº§é€‰æ‹© -->
          <view class="quick-option-group">
            <text class="group-title">é«˜çº§é€‰æ‹©</text>
            <view class="option-list">
              <view class="quick-option" data-condition="by_status" bindtap="selectByCondition">
                <text class="option-icon">ğŸ“Š</text>
                <text class="option-text">æŒ‰çŠ¶æ€ç­›é€‰</text>
              </view>
              <view class="quick-option" data-condition="by_priority" bindtap="selectByCondition">
                <text class="option-icon">ğŸ…</text>
                <text class="option-text">æŒ‰ä¼˜å…ˆçº§ç­›é€‰</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- é€‰æ‹©é™åˆ¶æç¤º -->
        <view class="selection-limit-info">
          <text class="limit-text">æœ€å¤§å¯é€‰æ‹© {{batchSelection.maxSelectLimit}} ä¸ªé¡¹ç›®</text>
          <text wx:if="{{selectedSchedules.length > 0}}" class="current-text">ï¼ˆå½“å‰å·²é€‰ {{selectedSchedules.length}} ä¸ªï¼‰</text>
        </view>
      </view>

      <!-- æ—¥ç¨‹å¡ç‰‡åˆ—è¡¨ -->
      <view class="schedule-cards">
        <!-- éª¨æ¶å±åŠ è½½ -->
        <view wx:if="{{loading && !refreshing}}" class="skeleton-container">
          <view wx:for="{{[1,2,3,4,5]}}" wx:key="*this" class="skeleton-card">
            <view class="skeleton-header">
              <view class="skeleton-avatar"></view>
              <view class="skeleton-info">
                <view class="skeleton-line skeleton-title"></view>
                <view class="skeleton-line skeleton-subtitle"></view>
              </view>
              <view class="skeleton-status"></view>
            </view>
            <view class="skeleton-content">
              <view class="skeleton-line skeleton-text"></view>
              <view class="skeleton-line skeleton-text short"></view>
            </view>
            <view class="skeleton-footer">
              <view class="skeleton-tag"></view>
              <view class="skeleton-tag"></view>
              <view class="skeleton-actions">
                <view class="skeleton-btn"></view>
                <view class="skeleton-btn"></view>
              </view>
            </view>
          </view>
        </view>

        <block wx:elif="{{filteredScheduleList.length > 0}}">
          <schedule-card 
            wx:for="{{filteredScheduleList}}" 
            wx:key="id"
            schedule="{{item}}"
            selectable="{{batchMode}}"
            selected="{{selectedSchedules.indexOf(item.id) > -1}}"
            show-actions="{{!batchMode}}"
            card-type="default"
            bind:tap="onScheduleCardTap"
            bind:longpress="onScheduleCardLongPress"
            bind:action="onScheduleCardAction"
            bind:select="onScheduleSelect">
          </schedule-card>
        </block>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:elif="{{!loading}}" class="empty-state">
          <text class="empty-icon">ğŸ“…</text>
          <text class="empty-title">æš‚æ— æ—¥ç¨‹å®‰æ’</text>
          <text class="empty-subtitle">
            {{currentFilters.time !== 'all' || currentFilters.status !== 'all' ? 'å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°æ—¥ç¨‹' : 'æ‚¨è¿˜æ²¡æœ‰ä»»ä½•æ—¥ç¨‹å®‰æ’'}}
          </text>
          <view wx:if="{{currentFilters.time !== 'all' || currentFilters.status !== 'all'}}" 
                class="empty-action"
                bindtap="clearFilters">
            <text class="empty-action-text">æ¸…é™¤ç­›é€‰æ¡ä»¶</text>
          </view>
        </view>
        
        <!-- é”™è¯¯çŠ¶æ€ -->
        <view wx:if="{{errorState.hasError}}" class="error-state">
          <text class="error-icon">âš ï¸</text>
          <text class="error-title">åŠ è½½å¤±è´¥</text>
          <text class="error-message">{{errorState.errorMessage}}</text>
          <view class="error-actions">
            <view wx:if="{{errorState.canRetry && errorState.retryCount < errorState.maxRetry}}" 
                  class="error-btn retry-btn"
                  bindtap="retryLastOperation">
              <text class="error-btn-text">é‡è¯•</text>
            </view>
            <view class="error-btn close-btn" bindtap="clearError">
              <text class="error-btn-text">å…³é—­</text>
            </view>
          </view>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view wx:if="{{loadingMore}}" class="loading-more">
          <view class="loading-spinner small"></view>
          <text class="loading-text">åŠ è½½æ›´å¤š...</text>
        </view>

        <!-- æ— æ›´å¤šæ•°æ® -->
        <view wx:elif="{{!hasMore && filteredScheduleList.length > 0}}" class="no-more">
          <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ—¥ç¨‹äº†</text>
        </view>
      </view>
    </view>

    <!-- æ‰¹é‡æ“ä½œé¢æ¿ -->
    <view wx:if="{{batchMode && selectedSchedules.length > 0}}" class="batch-actions-panel">
      <view class="batch-info">
        <text class="batch-count">å·²é€‰æ‹© {{selectedSchedules.length}} é¡¹</text>
        <text class="batch-subtitle">å¯æ‰§è¡Œå¤šç§æ‰¹é‡æ“ä½œ</text>
      </view>
      <view class="batch-actions">
        <view class="batch-btn" data-action="reschedule" bindtap="onBatchAction">
          <text class="batch-icon">ğŸ“…</text>
          <text class="batch-text">æ‰¹é‡è°ƒæ•´</text>
        </view>
        <view class="batch-btn danger" data-action="cancel" bindtap="onBatchAction">
          <text class="batch-icon">âŒ</text>
          <text class="batch-text">æ‰¹é‡å–æ¶ˆ</text>
        </view>
        <view class="batch-btn success" data-action="confirm" bindtap="onBatchAction">
          <text class="batch-icon">âœ…</text>
          <text class="batch-text">æ‰¹é‡ç¡®è®¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ç»„ä»¶ -->
  <schedule-filter 
    visible="{{showFilter}}"
    filters="{{currentFilters}}"
    bind:filter="onFilterChange">
  </schedule-filter>

  <!-- æ“ä½œå¼¹çª— -->
  <modal
    visible="{{showActionModal}}"
    title="é€‰æ‹©æ“ä½œ"
    bind:close="onActionModalClose">
    <view slot="content" class="action-modal-content">
      <view wx:for="{{actionModalActions}}" wx:key="key"
            class="action-modal-item"
            data-action="{{item.key}}"
            bindtap="onScheduleAction">
        <text class="action-modal-icon">{{item.icon}}</text>
        <text class="action-modal-text">{{item.label}}</text>
      </view>
    </view>
  </modal>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab-container">
    <view class="fab-btn" bindtap="addSchedule">
      <text class="fab-icon">+</text>
    </view>
  </view>
  
  <!-- æ—¶é—´è°ƒæ•´å¼¹çª— -->
  <time-adjust-modal
    visible="{{timeAdjustment.modalVisible}}"
    appointmentInfo="{{timeAdjustment.currentAppointment}}"
    isBatch="{{timeAdjustment.isBatch}}"
    batchAppointments="{{timeAdjustment.batchAppointments}}"
    availableSlots="{{timeAdjustment.availableSlots}}"
    bind:success="onTimeAdjustSuccess"
    bind:cancel="onTimeAdjustCancel"
    bind:close="hideTimeAdjustModal">
  </time-adjust-modal>
  
  <!-- è°ƒæ•´å†å²å¼¹çª— -->
  <modal
    visible="{{timeAdjustment.adjustmentHistory.modalVisible}}"
    title="è°ƒæ•´å†å²"
    type="fullscreen"
    bind:close="onCloseAdjustmentHistory">
    <adjustment-history
      appointmentId="{{timeAdjustment.adjustmentHistory.appointmentId}}"
      recorderId="{{timeAdjustment.adjustmentHistory.recorderId}}"
      bind:reapply="onReapplyAdjustment">
    </adjustment-history>
  </modal>
  
  <!-- å®¡æ‰¹ç®¡ç†ç»„ä»¶ -->
  <approval-manager
    show="{{approvalManagement.modalVisible}}"
    mode="{{approvalManagement.mode}}"
    request-id="{{approvalManagement.currentRequestId}}"
    user-role="{{approvalManagement.userRole}}"
    bind:view-detail="viewApprovalDetail"
    bind:approval-complete="onApprovalComplete"
    bind:close="closeApprovalManager">
  </approval-manager>

  <!-- æ‰¹é‡è°ƒæ•´æ“ä½œé¢æ¿ -->
  <modal
    visible="{{batchAdjustPanel.visible}}"
    title="æ‰¹é‡æ—¶é—´è°ƒæ•´"
    type="fullscreen"
    bind:close="cancelBatchAdjustment">
    <view slot="content" class="batch-adjust-panel">
      
      <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
      <view class="step-indicator">
        <view class="step-item {{batchAdjustPanel.currentStep >= 1 ? 'active' : ''}}">
          <view class="step-number">1</view>
          <text class="step-text">é€‰æ‹©è°ƒæ•´æ–¹å¼</text>
        </view>
        <view class="step-item {{batchAdjustPanel.currentStep >= 2 ? 'active' : ''}}">
          <view class="step-number">2</view>
          <text class="step-text">è®¾ç½®å‚æ•°</text>
        </view>
        <view class="step-item {{batchAdjustPanel.currentStep >= 3 ? 'active' : ''}}">
          <view class="step-number">3</view>
          <text class="step-text">å†²çªæ£€æµ‹</text>
        </view>
        <view class="step-item {{batchAdjustPanel.currentStep >= 4 ? 'active' : ''}}">
          <view class="step-number">4</view>
          <text class="step-text">ç¡®è®¤æ‰§è¡Œ</text>
        </view>
      </view>

      <!-- ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©è°ƒæ•´æ–¹å¼ -->
      <view wx:if="{{batchAdjustPanel.currentStep === 1}}" class="adjust-type-selection">
        <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
        <view class="batch-toolbar">
          <view class="toolbar-header">
            <view class="selected-count">
              <text class="count-number">{{batchAdjustPanel.totalCount}}</text>
              <text class="count-label">ä¸ªé¢„çº¦å·²é€‰æ‹©</text>
            </view>
            <view class="toolbar-actions">
              <button class="toolbar-btn quick-delay" bindtap="onQuickDelay">
                <text class="btn-icon">âš¡</text>
                <text class="btn-text">å¿«é€Ÿå»¶æœŸ</text>
              </button>
              <button class="toolbar-btn batch-reschedule" bindtap="onBatchReschedule">
                <text class="btn-icon">ğŸ“…</text>
                <text class="btn-text">æ‰¹é‡æ”¹æœŸ</text>
              </button>
              <button class="toolbar-btn smart-optimize" bindtap="onSmartOptimize">
                <text class="btn-icon">ğŸ¯</text>
                <text class="btn-text">æ™ºèƒ½ä¼˜åŒ–</text>
              </button>
            </view>
          </view>
          
          <!-- å¿«é€Ÿæ“ä½œèœå• -->
          <view class="quick-actions">
            <view class="action-group">
              <text class="group-title">å¿«é€Ÿå»¶æœŸ</text>
              <view class="action-buttons">
                <button class="quick-action-btn" data-delay="30" bindtap="onQuickDelaySelect">
                  <text class="delay-text">30åˆ†é’Ÿ</text>
                </button>
                <button class="quick-action-btn" data-delay="60" bindtap="onQuickDelaySelect">
                  <text class="delay-text">1å°æ—¶</text>
                </button>
                <button class="quick-action-btn" data-delay="120" bindtap="onQuickDelaySelect">
                  <text class="delay-text">2å°æ—¶</text>
                </button>
                <button class="quick-action-btn" data-delay="1440" bindtap="onQuickDelaySelect">
                  <text class="delay-text">1å¤©</text>
                </button>
              </view>
            </view>
            
            <view class="action-group">
              <text class="group-title">å¸¸ç”¨æ—¶é—´</text>
              <view class="action-buttons">
                <button class="quick-action-btn" data-time="tomorrow-9" bindtap="onQuickTimeSelect">
                  <text class="time-text">æ˜æ—¥9:00</text>
                </button>
                <button class="quick-action-btn" data-time="tomorrow-14" bindtap="onQuickTimeSelect">
                  <text class="time-text">æ˜æ—¥14:00</text>
                </button>
                <button class="quick-action-btn" data-time="next-monday" bindtap="onQuickTimeSelect">
                  <text class="time-text">ä¸‹å‘¨ä¸€</text>
                </button>
                <button class="quick-action-btn" data-time="weekend" bindtap="onQuickTimeSelect">
                  <text class="time-text">å‘¨æœ«</text>
                </button>
              </view>
            </view>
          </view>
        </view>

        <view class="panel-title">
          <text class="title-text">é€‰æ‹©æ‰¹é‡è°ƒæ•´æ–¹å¼</text>
          <view class="title-tips">
            <text class="tips-text">ğŸ’¡ é€‰æ‹©æœ€é€‚åˆçš„è°ƒæ•´æ–¹å¼ä»¥æé«˜æ•ˆç‡</text>
          </view>
        </view>
        
        <view class="adjust-type-list">
          <view class="adjust-type-item {{batchAdjustPanel.adjustType === 'uniform' ? 'selected' : ''}}" 
                data-type="uniform" 
                bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ“…</view>
            <view class="type-info">
              <text class="type-title">ç»Ÿä¸€è°ƒæ•´</text>
              <text class="type-desc">å°†æ‰€æœ‰é¢„çº¦è°ƒæ•´åˆ°ç›¸åŒçš„æ—¶é—´åç§»</text>
              <view class="type-features">
                <text class="feature-item">â€¢ ç®€å•å¿«é€Ÿ</text>
                <text class="feature-item">â€¢ ä¿æŒç›¸å¯¹é¡ºåº</text>
                <text class="feature-item">â€¢ é€‚åˆæ•´ä½“å»¶æœŸ</text>
              </view>
            </view>
            <view class="type-indicator">
              <text class="indicator-text">{{batchAdjustPanel.adjustType === 'uniform' ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}}</text>
            </view>
          </view>
          
          <view class="adjust-type-item {{batchAdjustPanel.adjustType === 'staggered' ? 'selected' : ''}}" 
                data-type="staggered" 
                bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">â°</view>
            <view class="type-info">
              <text class="type-title">é”™å¼€è°ƒæ•´</text>
              <text class="type-desc">æŒ‰å›ºå®šé—´éš”ä¾æ¬¡å®‰æ’é¢„çº¦æ—¶é—´</text>
              <view class="type-features">
                <text class="feature-item">â€¢ é¿å…æ—¶é—´å†²çª</text>
                <text class="feature-item">â€¢ å‡åŒ€åˆ†å¸ƒ</text>
                <text class="feature-item">â€¢ å¯æ§é—´éš”</text>
              </view>
            </view>
            <view class="type-indicator">
              <text class="indicator-text">{{batchAdjustPanel.adjustType === 'staggered' ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}}</text>
            </view>
          </view>
          
          <view class="adjust-type-item {{batchAdjustPanel.adjustType === 'smart' ? 'selected' : ''}}" 
                data-type="smart" 
                bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ¤–</view>
            <view class="type-info">
              <text class="type-title">æ™ºèƒ½è°ƒæ•´</text>
              <text class="type-desc">åŸºäºè·ç¦»ã€ä¼˜å…ˆçº§ç­‰å› ç´ æ™ºèƒ½å®‰æ’</text>
              <view class="type-features">
                <text class="feature-item">â€¢ AIæ™ºèƒ½åˆ†æ</text>
                <text class="feature-item">â€¢ å¤šå› å­ä¼˜åŒ–</text>
                <text class="feature-item">â€¢ æœ€ä¼˜è·¯å¾„</text>
              </view>
            </view>
            <view class="type-indicator">
              <text class="indicator-text">{{batchAdjustPanel.adjustType === 'smart' ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}}</text>
            </view>
          </view>
          
          <view class="adjust-type-item {{batchAdjustPanel.adjustType === 'proportion' ? 'selected' : ''}}" 
                data-type="proportion" 
                bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ“Š</view>
            <view class="type-info">
              <text class="type-title">æŒ‰æ¯”ä¾‹è°ƒæ•´</text>
              <text class="type-desc">æ ¹æ®é¢„çº¦é‡è¦æ€§æŒ‰æ¯”ä¾‹åˆ†é…æ—¶é—´</text>
              <view class="type-features">
                <text class="feature-item">â€¢ å·®å¼‚åŒ–å¤„ç†</text>
                <text class="feature-item">â€¢ ä¼˜å…ˆçº§æƒé‡</text>
                <text class="feature-item">â€¢ ç²¾ç»†æ§åˆ¶</text>
              </view>
            </view>
            <view class="type-indicator">
              <text class="indicator-text">{{batchAdjustPanel.adjustType === 'proportion' ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}}</text>
            </view>
          </view>
          
          <view class="adjust-type-item {{batchAdjustPanel.adjustType === 'template' ? 'selected' : ''}}" 
                data-type="template" 
                bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ“‹</view>
            <view class="type-info">
              <text class="type-title">æ¨¡æ¿è°ƒæ•´</text>
              <text class="type-desc">ä½¿ç”¨é¢„è®¾çš„è°ƒæ•´æ¨¡æ¿å¿«é€Ÿå¤„ç†</text>
              <view class="type-features">
                <text class="feature-item">â€¢ é¢„è®¾æ¨¡æ¿</text>
                <text class="feature-item">â€¢ ä¸€é”®åº”ç”¨</text>
                <text class="feature-item">â€¢ å¯å¤ç”¨</text>
              </view>
            </view>
            <view class="type-indicator">
              <text class="indicator-text">{{batchAdjustPanel.adjustType === 'template' ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}}</text>
            </view>
          </view>
          
          <view class="adjust-type-item {{batchAdjustPanel.adjustType === 'custom' ? 'selected' : ''}}" 
                data-type="custom" 
                bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">âš™ï¸</view>
            <view class="type-info">
              <text class="type-title">è‡ªå®šä¹‰è°ƒæ•´</text>
              <text class="type-desc">ä¸ºæ¯ä¸ªé¢„çº¦è®¾ç½®ä¸åŒçš„è°ƒæ•´è§„åˆ™</text>
              <view class="type-features">
                <text class="feature-item">â€¢ å®Œå…¨è‡ªå®šä¹‰</text>
                <text class="feature-item">â€¢ ä¸ªæ€§åŒ–è®¾ç½®</text>
                <text class="feature-item">â€¢ ç²¾ç¡®æ§åˆ¶</text>
              </view>
            </view>
            <view class="type-indicator">
              <text class="indicator-text">{{batchAdjustPanel.adjustType === 'custom' ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}}</text>
            </view>
          </view>
        </view>
        
        <!-- æ“ä½œæç¤º -->
        <view class="operation-tips">
          <view class="tip-item">
            <text class="tip-icon">ğŸ’¡</text>
            <text class="tip-text">å»ºè®®ä¼˜å…ˆé€‰æ‹©æ™ºèƒ½è°ƒæ•´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¼˜åŒ–æ—¶é—´å®‰æ’</text>
          </view>
          <view class="tip-item">
            <text class="tip-icon">âš ï¸</text>
            <text class="tip-text">è°ƒæ•´å‰è¯·ç¡®è®¤æ‚£è€…è”ç³»ä¿¡æ¯ï¼Œä»¥ä¾¿åŠæ—¶é€šçŸ¥</text>
          </view>
        </view>
      </view>

      <!-- ç¬¬äºŒæ­¥ï¼šè®¾ç½®å‚æ•° -->
      <view wx:if="{{batchAdjustPanel.currentStep === 2}}" class="adjust-params-setting">
        <view class="panel-title">
          <text class="title-text">è°ƒæ•´å‚æ•°è®¾ç½®</text>
          <view class="title-info">
            <text class="info-text">å½“å‰æ–¹å¼ï¼š</text>
            <text class="info-value">{{batchAdjustPanel.adjustTypeName}}</text>
          </view>
        </view>
        
        <!-- ç»Ÿä¸€è°ƒæ•´å‚æ•° -->
        <view wx:if="{{batchAdjustPanel.adjustType === 'uniform'}}" class="uniform-params">
          <view class="param-section">
            <view class="section-title">
              <text class="section-text">åŸºæœ¬è®¾ç½®</text>
            </view>
            
            <view class="param-group">
              <text class="param-label">è°ƒæ•´æ–¹å¼</text>
              <view class="param-options">
                <button class="param-btn {{batchAdjustPanel.adjustParams.delayType === 'minutes' ? 'active' : ''}}" 
                        data-field="delayType" data-value="minutes" bindtap="onAdjustParamChange">åˆ†é’Ÿ</button>
                <button class="param-btn {{batchAdjustPanel.adjustParams.delayType === 'hours' ? 'active' : ''}}" 
                        data-field="delayType" data-value="hours" bindtap="onAdjustParamChange">å°æ—¶</button>
                <button class="param-btn {{batchAdjustPanel.adjustParams.delayType === 'days' ? 'active' : ''}}" 
                        data-field="delayType" data-value="days" bindtap="onAdjustParamChange">å¤©æ•°</button>
                <button class="param-btn {{batchAdjustPanel.adjustParams.delayType === 'fixed' ? 'active' : ''}}" 
                        data-field="delayType" data-value="fixed" bindtap="onAdjustParamChange">å›ºå®šæ—¶é—´</button>
              </view>
            </view>
            
            <view wx:if="{{batchAdjustPanel.adjustParams.delayType !== 'fixed'}}" class="param-group">
              <text class="param-label">å»¶è¿Ÿæ•°é‡</text>
              <view class="param-input-group">
                <input class="param-input" 
                       type="number" 
                       value="{{batchAdjustPanel.adjustParams.delayValue}}"
                       data-field="delayValue" 
                       bindinput="onAdjustParamChange" 
                       placeholder="è¾“å…¥æ•°é‡" />
                <text class="param-unit">{{batchAdjustPanel.adjustParams.delayType === 'minutes' ? 'åˆ†é’Ÿ' : (batchAdjustPanel.adjustParams.delayType === 'hours' ? 'å°æ—¶' : 'å¤©')}}</text>
              </view>
            </view>
            
            <view wx:if="{{batchAdjustPanel.adjustParams.delayType === 'fixed'}}" class="param-group">
              <view class="param-row">
                <text class="param-label">ç›®æ ‡æ—¥æœŸ</text>
                <picker mode="date" 
                        value="{{batchAdjustPanel.adjustParams.targetDate}}"
                        data-field="targetDate"
                        bindchange="onAdjustParamChange">
                  <input class="param-input" value="{{batchAdjustPanel.adjustParams.targetDate}}" disabled />
                </picker>
              </view>
              
              <view class="param-row">
                <text class="param-label">ç›®æ ‡æ—¶é—´</text>
                <picker mode="time" 
                        value="{{batchAdjustPanel.adjustParams.targetTime}}"
                        data-field="targetTime"
                        bindchange="onAdjustParamChange">
                  <input class="param-input" value="{{batchAdjustPanel.adjustParams.targetTime}}" disabled />
                </picker>
              </view>
            </view>
          </view>
          
          <view class="param-section">
            <view class="section-title">
              <text class="section-text">é«˜çº§è®¾ç½®</text>
            </view>
            
            <view class="param-group">
              <view class="param-switch">
                <text class="switch-label">ä¿æŒåŸæœ‰é¡ºåº</text>
                <switch checked="{{batchAdjustPanel.adjustParams.keepOrder}}" 
                        data-field="keepOrder" 
                        bindchange="onAdjustParamChange" />
              </view>
            </view>
            
            <view class="param-group">
              <view class="param-switch">
                <text class="switch-label">é¿å¼€å·¥ä½œæ—¶é—´å¤–</text>
                <switch checked="{{batchAdjustPanel.adjustParams.avoidNonWorkHours}}" 
                        data-field="avoidNonWorkHours" 
                        bindchange="onAdjustParamChange" />
              </view>
            </view>
            
            <view class="param-group">
              <view class="param-switch">
                <text class="switch-label">é¿å¼€å‘¨æœ«</text>
                <switch checked="{{batchAdjustPanel.adjustParams.avoidWeekends}}" 
                        data-field="avoidWeekends" 
                        bindchange="onAdjustParamChange" />
              </view>
            </view>
          </view>
        </view>
        
        <!-- é”™å¼€è°ƒæ•´å‚æ•° -->
        <view wx:if="{{batchAdjustPanel.adjustType === 'staggered'}}" class="staggered-params">
          <view class="param-group">
            <text class="param-label">å¼€å§‹æ—¶é—´</text>
            <picker mode="time" 
                    value="{{batchAdjustPanel.adjustParams.startTime}}"
                    data-field="startTime"
                    bindchange="onAdjustParamChange">
              <input class="param-input" value="{{batchAdjustPanel.adjustParams.startTime}}" disabled />
            </picker>
          </view>
          
          <view class="param-group">
            <text class="param-label">é—´éš”æ—¶é—´</text>
            <input class="param-input" 
                   type="number" 
                   value="{{batchAdjustPanel.adjustParams.interval}}"
                   data-field="interval" 
                   bindinput="onAdjustParamChange" />
            <text class="param-unit">åˆ†é’Ÿ</text>
          </view>
        </view>
        
        <!-- æ™ºèƒ½è°ƒæ•´å‚æ•° -->
        <view wx:if="{{batchAdjustPanel.adjustType === 'smart'}}" class="smart-params">
          <view class="param-group">
            <text class="param-label">ä¼˜åŒ–ç­–ç•¥</text>
            <view class="param-options">
              <button class="param-btn {{batchAdjustPanel.adjustParams.strategy === 'distance' ? 'active' : ''}}" 
                      data-field="strategy" data-value="distance" bindtap="onAdjustParamChange">è·ç¦»ä¼˜å…ˆ</button>
              <button class="param-btn {{batchAdjustPanel.adjustParams.strategy === 'priority' ? 'active' : ''}}" 
                      data-field="strategy" data-value="priority" bindtap="onAdjustParamChange">ä¼˜å…ˆçº§ä¼˜å…ˆ</button>
              <button class="param-btn {{batchAdjustPanel.adjustParams.strategy === 'time' ? 'active' : ''}}" 
                      data-field="strategy" data-value="time" bindtap="onAdjustParamChange">æ—¶é—´ä¼˜å…ˆ</button>
            </view>
          </view>
          
          <view class="param-group">
            <text class="param-label">è€ƒè™‘äº¤é€š</text>
            <switch checked="{{batchAdjustPanel.adjustParams.considerTraffic}}" 
                    data-field="considerTraffic" 
                    bindchange="onAdjustParamChange" />
          </view>
          
          <view class="param-group">
            <text class="param-label">é¿å¼€å‘¨æœ«</text>
            <switch checked="{{batchAdjustPanel.adjustParams.avoidWeekends}}" 
                    data-field="avoidWeekends" 
                    bindchange="onAdjustParamChange" />
          </view>
        </view>
        
        <!-- å¢å¼ºçš„é¢„è§ˆåŒºåŸŸ -->
        <view class="enhanced-preview-section">
          <view class="preview-header">
            <view class="preview-title">
              <text class="title-text">å®æ—¶é¢„è§ˆ</text>
              <view class="preview-stats">
                <text class="stats-text">{{batchAdjustPanel.preview.length}} ä¸ªé¡¹ç›®</text>
              </view>
            </view>
            <view class="preview-controls">
              <button class="preview-btn" bindtap="onRefreshPreview">
                <text class="btn-icon">ğŸ”„</text>
                <text class="btn-text">åˆ·æ–°</text>
              </button>
              <button class="preview-btn" bindtap="onTogglePreviewDetail">
                <text class="btn-icon">{{showPreviewDetail ? 'ğŸ”¼' : 'ğŸ”½'}}</text>
                <text class="btn-text">{{showPreviewDetail ? 'ç®€åŒ–' : 'è¯¦ç»†'}}</text>
              </button>
            </view>
          </view>
          
          <view wx:if="{{batchAdjustPanel.preview.length > 0}}" class="enhanced-preview-list">
            <view wx:for="{{batchAdjustPanel.preview}}" wx:key="scheduleId" class="enhanced-preview-item {{item.conflict ? 'conflict' : ''}}">
              <view class="preview-main">
                <view class="preview-patient">
                  <text class="patient-name">{{item.patientName}}</text>
                  <view wx:if="{{item.priority}}" class="priority-tag {{item.priority}}">
                    <text class="priority-text">{{item.priority}}</text>
                  </view>
                </view>
                
                <view class="preview-time-comparison">
                  <view class="time-row">
                    <text class="time-label">åŸæ—¶é—´</text>
                    <text class="original-time">{{item.originalTime}}</text>
                  </view>
                  <view class="time-arrow">â†’</view>
                  <view class="time-row">
                    <text class="time-label">æ–°æ—¶é—´</text>
                    <text class="new-time {{item.conflict ? 'conflict' : 'success'}}">{{item.newTime}}</text>
                  </view>
                </view>
                
                <view wx:if="{{item.conflict}}" class="conflict-indicator">
                  <text class="conflict-icon">âš ï¸</text>
                  <text class="conflict-text">æ—¶é—´å†²çª</text>
                </view>
              </view>
              
              <view wx:if="{{showPreviewDetail}}" class="preview-details">
                <view wx:if="{{item.smartReason}}" class="detail-item">
                  <text class="detail-label">è°ƒæ•´åŸå› </text>
                  <text class="detail-value">{{item.smartReason}}</text>
                </view>
                
                <view wx:if="{{item.duration}}" class="detail-item">
                  <text class="detail-label">æœåŠ¡æ—¶é•¿</text>
                  <text class="detail-value">{{item.duration}} åˆ†é’Ÿ</text>
                </view>
                
                <view wx:if="{{item.distance}}" class="detail-item">
                  <text class="detail-label">è·ç¦»</text>
                  <text class="detail-value">{{item.distance}} å…¬é‡Œ</text>
                </view>
              </view>
            </view>
          </view>
          
          <view wx:else class="empty-preview">
            <text class="empty-text">æš‚æ— é¢„è§ˆæ•°æ®ï¼Œè¯·å…ˆè®¾ç½®è°ƒæ•´å‚æ•°</text>
          </view>
        </view>
        
        <view class="step-buttons">
          <button class="btn-secondary" bindtap="cancelBatchAdjustment">
            <text class="btn-icon">âŒ</text>
            <text class="btn-text">å–æ¶ˆ</text>
          </button>
          <button class="btn-outline" bindtap="onSaveAdjustTemplate">
            <text class="btn-icon">ğŸ’¾</text>
            <text class="btn-text">ä¿å­˜æ¨¡æ¿</text>
          </button>
          <button class="btn-primary" bindtap="performConflictDetection">
            <text class="btn-icon">ğŸ”</text>
            <text class="btn-text">æ£€æµ‹å†²çª</text>
          </button>
        </view>
      </view>

      <!-- ç¬¬ä¸‰æ­¥ï¼šå†²çªæ£€æµ‹ç»“æœ -->
      <view wx:if="{{batchAdjustPanel.currentStep === 3}}" class="conflict-detection">
        <view class="panel-title">å†²çªæ£€æµ‹ç»“æœ</view>
        
        <view wx:if="{{batchAdjustPanel.conflicts.length === 0}}" class="no-conflict">
          <view class="success-icon">âœ…</view>
          <text class="success-text">æœªå‘ç°æ—¶é—´å†²çªï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œè°ƒæ•´</text>
        </view>
        
        <view wx:else class="conflict-list">
          <view class="conflict-summary">
            <text class="conflict-count">å‘ç° {{batchAdjustPanel.conflicts.length}} ä¸ªæ—¶é—´å†²çª</text>
          </view>
          
          <view wx:for="{{batchAdjustPanel.conflicts}}" wx:key="scheduleId" class="conflict-item">
            <view class="conflict-info">
              <text class="conflict-patient">{{item.patientName}}</text>
              <text class="conflict-details">{{item.details}}</text>
            </view>
            <view class="conflict-type {{item.type}}">{{item.type === 'internal' ? 'å†…éƒ¨å†²çª' : 'å¤–éƒ¨å†²çª'}}</view>
          </view>
          
          <button class="btn-warning" bindtap="showBatchConflictHandler">å¤„ç†å†²çª</button>
        </view>
        
        <view class="step-buttons">
          <button class="btn-secondary" bindtap="onBatchAdjustTypeSelect">è¿”å›è®¾ç½®</button>
          <button wx:if="{{batchAdjustPanel.conflicts.length === 0}}" 
                  class="btn-primary" 
                  bindtap="setCurrentStep" 
                  data-step="4">ç¡®è®¤æ‰§è¡Œ</button>
        </view>
      </view>

      <!-- ç¬¬å››æ­¥ï¼šç¡®è®¤æ‰§è¡Œ -->
      <view wx:if="{{batchAdjustPanel.currentStep === 4}}" class="confirm-execution">
        <view class="panel-title">ç¡®è®¤æ‰§è¡Œæ‰¹é‡è°ƒæ•´</view>
        
        <view class="execution-summary">
          <view class="summary-item">
            <text class="summary-label">è°ƒæ•´æ–¹å¼ï¼š</text>
            <text class="summary-value">{{batchAdjustPanel.adjustType}}</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">å½±å“é¢„çº¦ï¼š</text>
            <text class="summary-value">{{batchAdjustPanel.totalCount}} ä¸ª</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">å†²çªå¤„ç†ï¼š</text>
            <text class="summary-value">{{batchAdjustPanel.conflicts.length === 0 ? 'æ— å†²çª' : 'å·²è§£å†³'}}</text>
          </view>
        </view>
        
        <view class="final-preview">
          <view class="preview-title">æœ€ç»ˆè°ƒæ•´æ–¹æ¡ˆ</view>
          <view class="final-preview-list">
            <view wx:for="{{batchAdjustPanel.preview}}" 
                  wx:key="scheduleId" 
                  class="final-preview-item {{item.status}}">
              <view class="preview-patient">{{item.patientName}}</view>
              <view class="preview-time-change">
                <text class="original">{{item.originalTime}}</text>
                <text class="arrow">â†’</text>
                <text class="new">{{item.newTime}}</text>
              </view>
              <view wx:if="{{item.resolutionMethod}}" class="resolution-method">{{item.resolutionMethod}}</view>
            </view>
          </view>
        </view>
        
        <view class="step-buttons">
          <button class="btn-secondary" bindtap="cancelBatchAdjustment">å–æ¶ˆ</button>
          <button class="btn-primary" bindtap="confirmBatchAdjustment">ç¡®è®¤æ‰§è¡Œ</button>
        </view>
      </view>
      
    </view>
  </modal>

  <!-- æ‰¹é‡å†²çªå¤„ç†ç•Œé¢ -->
  <modal
    visible="{{batchConflictPanel.visible}}"
    title="å†²çªå¤„ç†"
    type="fullscreen"
    bind:close="closeBatchConflictPanel">
    <view slot="content" class="batch-conflict-panel">
      
      <!-- å¢å¼ºçš„å†²çªæ€»è§ˆ -->
      <view class="enhanced-conflict-overview">
        <view class="overview-header">
          <text class="overview-title">ğŸš¨ å†²çªæƒ…å†µæ€»è§ˆ</text>
          <view class="overview-severity">
            <view class="severity-indicator {{batchConflictPanel.overallSeverity}}">
              <text class="severity-text">{{batchConflictPanel.overallSeverityText}}</text>
            </view>
          </view>
        </view>
        
        <view class="enhanced-overview-stats">
          <view class="stat-card total">
            <view class="stat-icon">âš ï¸</view>
            <view class="stat-content">
              <text class="stat-number">{{batchConflictPanel.conflicts.length}}</text>
              <text class="stat-label">æ€»å†²çªæ•°</text>
              <text class="stat-desc">éœ€è¦å¤„ç†çš„å†²çªé¡¹</text>
            </view>
          </view>
          
          <view class="stat-card internal">
            <view class="stat-icon">ğŸ”„</view>
            <view class="stat-content">
              <text class="stat-number">{{batchConflictPanel.internalConflicts.length}}</text>
              <text class="stat-label">å†…éƒ¨å†²çª</text>
              <text class="stat-desc">æ‰¹é‡è°ƒæ•´é¡¹é—´å†²çª</text>
            </view>
          </view>
          
          <view class="stat-card external">
            <view class="stat-icon">ğŸ”—</view>
            <view class="stat-content">
              <text class="stat-number">{{batchConflictPanel.externalConflicts.length}}</text>
              <text class="stat-label">å¤–éƒ¨å†²çª</text>
              <text class="stat-desc">ä¸ç°æœ‰é¢„çº¦å†²çª</text>
            </view>
          </view>
          
          <view class="stat-card critical">
            <view class="stat-icon">ğŸ”¥</view>
            <view class="stat-content">
              <text class="stat-number">{{batchConflictPanel.criticalConflicts.length}}</text>
              <text class="stat-label">ä¸¥é‡å†²çª</text>
              <text class="stat-desc">é«˜ä¼˜å…ˆçº§å†²çª</text>
            </view>
          </view>
        </view>
        
        <!-- å†²çªåˆ†å¸ƒå›¾è¡¨ -->
        <view class="conflict-distribution">
          <text class="distribution-title">å†²çªä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ</text>
          <view class="severity-bars">
            <view class="severity-bar high">
              <view class="bar-fill" style="width: {{batchConflictPanel.severityStats.high.percentage}}%"></view>
              <text class="bar-label">ä¸¥é‡ ({{batchConflictPanel.severityStats.high.count}})</text>
            </view>
            <view class="severity-bar medium">
              <view class="bar-fill" style="width: {{batchConflictPanel.severityStats.medium.percentage}}%"></view>
              <text class="bar-label">ä¸­ç­‰ ({{batchConflictPanel.severityStats.medium.count}})</text>
            </view>
            <view class="severity-bar low">
              <view class="bar-fill" style="width: {{batchConflictPanel.severityStats.low.percentage}}%"></view>
              <text class="bar-label">è½»å¾® ({{batchConflictPanel.severityStats.low.count}})</text>
            </view>
          </view>
        </view>
        
        <!-- å†²çªå½±å“è¯„ä¼° -->
        <view class="conflict-impact-assessment">
          <text class="assessment-title">å½±å“è¯„ä¼°</text>
          <view class="impact-items">
            <view class="impact-item">
              <text class="impact-icon">ğŸ‘¥</text>
              <text class="impact-text">å½±å“æ‚£è€…: {{batchConflictPanel.impactAnalysis.affectedPatients}} ä½</text>
            </view>
            <view class="impact-item">
              <text class="impact-icon">â°</text>
              <text class="impact-text">æ—¶é—´å»¶è¯¯: {{batchConflictPanel.impactAnalysis.totalDelay}} å°æ—¶</text>
            </view>
            <view class="impact-item">
              <text class="impact-icon">ğŸ’°</text>
              <text class="impact-text">ç»æµæŸå¤±: Â¥{{batchConflictPanel.impactAnalysis.economicLoss}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å¢å¼ºçš„è§£å†³ç­–ç•¥é€‰æ‹© -->
      <view class="enhanced-resolution-strategy">
        <view class="strategy-header">
          <text class="strategy-title">ğŸ é€‰æ‹©è§£å†³ç­–ç•¥</text>
          <view class="strategy-tips">
            <view class="tip-item">
              <text class="tip-icon">â„¹ï¸</text>
              <text class="tip-text">å»ºè®®ä¼˜å…ˆä½¿ç”¨æ™ºèƒ½è‡ªåŠ¨è§£å†³</text>
            </view>
          </view>
        </view>
        
        <view class="enhanced-strategy-options">
          <view class="strategy-option-card {{batchConflictPanel.resolutionStrategy === 'auto' ? 'active' : ''}}" 
                data-strategy="auto" 
                bindtap="onConflictResolutionSelect">
            <view class="strategy-header-card">
              <view class="strategy-icon-wrapper">
                <view class="strategy-icon auto">ğŸ¤–</view>
                <view class="strategy-badge recommended">æ¨è</view>
              </view>
              <view class="strategy-info">
                <text class="strategy-name">æ™ºèƒ½è‡ªåŠ¨è§£å†³</text>
                <text class="strategy-subtitle">é«˜æ•ˆã€å‡†ç¡®ã€çœæ—¶</text>
              </view>
              <view class="strategy-status">
                <text class="status-text">{{batchConflictPanel.resolutionStrategy === 'auto' ? 'å·²é€‰ä¸­' : 'ç‚¹å‡»é€‰æ‹©'}}</text>
              </view>
            </view>
            
            <view class="strategy-description">
              <text class="description-text">ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æå†²çªåŸå› ï¼Œæ‰¾åˆ°æœ€ä¼˜çš„æ—¶é—´é‡æ–°å®‰æ’æ–¹æ¡ˆã€‚</text>
            </view>
            
            <view class="strategy-features">
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">æ™ºèƒ½åˆ†ææœ€ä¼˜æ—¶é—´</text>
              </view>
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">è€ƒè™‘å¤šç§çº¦æŸæ¡ä»¶</text>
              </view>
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">ä¿éšœæœåŠ¡è¿ç»­æ€§</text>
              </view>
            </view>
            
            <view class="strategy-metrics">
              <view class="metric-item">
                <text class="metric-label">æˆåŠŸç‡</text>
                <text class="metric-value">95%</text>
              </view>
              <view class="metric-item">
                <text class="metric-label">å¹³å‡æ—¶é—´</text>
                <text class="metric-value">30ç§’</text>
              </view>
              <view class="metric-item">
                <text class="metric-label">æ»¡æ„åº¦</text>
                <text class="metric-value">4.8â˜…</text>
              </view>
            </view>
          </view>
          
          <view class="strategy-option-card {{batchConflictPanel.resolutionStrategy === 'manual' ? 'active' : ''}}" 
                data-strategy="manual" 
                bindtap="onConflictResolutionSelect">
            <view class="strategy-header-card">
              <view class="strategy-icon-wrapper">
                <view class="strategy-icon manual">ğŸ‘¤</view>
                <view class="strategy-badge expert">ä¸“ä¸š</view>
              </view>
              <view class="strategy-info">
                <text class="strategy-name">æ‰‹åŠ¨ç²¾å‡†è§£å†³</text>
                <text class="strategy-subtitle">çµæ´»ã€å¯æ§ã€ä¸ªæ€§åŒ–</text>
              </view>
              <view class="strategy-status">
                <text class="status-text">{{batchConflictPanel.resolutionStrategy === 'manual' ? 'å·²é€‰ä¸­' : 'ç‚¹å‡»é€‰æ‹©'}}</text>
              </view>
            </view>
            
            <view class="strategy-description">
              <text class="description-text">ä¸ºæ¯ä¸ªå†²çªé¡¹ç›®æ‰‹åŠ¨é€‰æ‹©å¤„ç†æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µçµæ´»è°ƒæ•´ã€‚</text>
            </view>
            
            <view class="strategy-features">
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">å®Œå…¨æ§åˆ¶å¤„ç†è¿‡ç¨‹</text>
              </view>
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">ä¸ªæ€§åŒ–è§£å†³æ–¹æ¡ˆ</text>
              </view>
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">ä¸“ä¸šç»éªŒæŒ‡å¯¼</text>
              </view>
            </view>
            
            <view class="strategy-complexity">
              <text class="complexity-label">å¤æ‚åº¦:</text>
              <view class="complexity-bars">
                <view class="complexity-bar active"></view>
                <view class="complexity-bar active"></view>
                <view class="complexity-bar active"></view>
                <view class="complexity-bar"></view>
                <view class="complexity-bar"></view>
              </view>
              <text class="complexity-text">ä¸­ç­‰</text>
            </view>
          </view>
          
          <view class="strategy-option-card {{batchConflictPanel.resolutionStrategy === 'skip' ? 'active' : ''}}" 
                data-strategy="skip" 
                bindtap="onConflictResolutionSelect">
            <view class="strategy-header-card">
              <view class="strategy-icon-wrapper">
                <view class="strategy-icon skip">â­ï¸</view>
                <view class="strategy-badge fast">å¿«é€Ÿ</view>
              </view>
              <view class="strategy-info">
                <text class="strategy-name">è·³è¿‡å†²çªé¡¹ç›®</text>
                <text class="strategy-subtitle">ç®€å•ã€å¿«é€Ÿã€ä¿å®ˆ</text>
              </view>
              <view class="strategy-status">
                <text class="status-text">{{batchConflictPanel.resolutionStrategy === 'skip' ? 'å·²é€‰ä¸­' : 'ç‚¹å‡»é€‰æ‹©'}}</text>
              </view>
            </view>
            
            <view class="strategy-description">
              <text class="description-text">è·³è¿‡æ‰€æœ‰å†²çªé¡¹ç›®ï¼Œä»…å¤„ç†æ— å†²çªçš„é¢„çº¦ï¼Œä¿æŒåŸæœ‰æ—¶é—´å®‰æ’ã€‚</text>
            </view>
            
            <view class="strategy-features">
              <view class="feature-item warning">
                <text class="feature-icon">âš ï¸</text>
                <text class="feature-text">éƒ¨åˆ†é¡¹ç›®æ— æ³•è°ƒæ•´</text>
              </view>
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">ä¿æŒåŸæœ‰æ—¶é—´ä¸å˜</text>
              </view>
              <view class="feature-item">
                <text class="feature-icon">âœ“</text>
                <text class="feature-text">æ“ä½œç®€å•å¿«é€Ÿ</text>
              </view>
            </view>
            
            <view class="strategy-impact">
              <view class="impact-item">
                <text class="impact-label">å°†è·³è¿‡:</text>
                <text class="impact-value">{{batchConflictPanel.conflicts.length}} ä¸ªå†²çªé¡¹ç›®</text>
              </view>
              <view class="impact-item">
                <text class="impact-label">å°†å¤„ç†:</text>
                <text class="impact-value">{{batchAdjustPanel.totalCount - batchConflictPanel.conflicts.length}} ä¸ªæ— å†²çªé¡¹ç›®</text>
              </view>
            </view>
          </view>
          
          <!-- æ™ºèƒ½æ¨èé€‰é¡¹ -->
          <view class="strategy-option-card smart-recommendation" 
                data-strategy="smart" 
                bindtap="onConflictResolutionSelect">
            <view class="strategy-header-card">
              <view class="strategy-icon-wrapper">
                <view class="strategy-icon smart">ğŸ¤”</view>
                <view class="strategy-badge ai">æ™ºèƒ½æ¨è</view>
              </view>
              <view class="strategy-info">
                <text class="strategy-name">æ™ºèƒ½æ··åˆç­–ç•¥</text>
                <text class="strategy-subtitle">åŸºäºAIçš„æ™ºèƒ½å†³ç­–</text>
              </view>
              <view class="strategy-status">
                <text class="status-text">ç‚¹å‡»é€‰æ‹©</text>
              </view>
            </view>
            
            <view class="strategy-description">
              <text class="description-text">åŸºäºå†å²æ•°æ®å’Œå½“å‰æƒ…å†µï¼Œæ™ºèƒ½ç»„åˆå¤šç§ç­–ç•¥ï¼Œä¸ºæ‚¨æ¨èæœ€ä¼˜è§£å†³æ–¹æ¡ˆã€‚</text>
            </view>
            
            <view class="ai-analysis">
              <text class="ai-title">ğŸ§  AI åˆ†æç»“æœï¼š</text>
              <view class="ai-suggestions">
                <view class="ai-suggestion">
                  <text class="suggestion-icon">â€¢</text>
                  <text class="suggestion-text">70% é¡¹ç›®å»ºè®®è‡ªåŠ¨è§£å†³</text>
                </view>
                <view class="ai-suggestion">
                  <text class="suggestion-icon">â€¢</text>
                  <text class="suggestion-text">20% é¡¹ç›®éœ€è¦æ‰‹åŠ¨å¹²é¢„</text>
                </view>
                <view class="ai-suggestion">
                  <text class="suggestion-icon">â€¢</text>
                  <text class="suggestion-text">10% é¡¹ç›®å»ºè®®è·³è¿‡</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- ç­–ç•¥å¯¹æ¯”è¡¨ -->
        <view class="strategy-comparison">
          <text class="comparison-title">ç­–ç•¥å¯¹æ¯”ä¸€è§ˆ</text>
          <view class="comparison-table">
            <view class="comparison-row header">
              <text class="col-strategy">ç­–ç•¥</text>
              <text class="col-time">æ—¶é—´</text>
              <text class="col-complexity">å¤æ‚åº¦</text>
              <text class="col-success">æˆåŠŸç‡</text>
            </view>
            <view class="comparison-row">
              <text class="col-strategy">è‡ªåŠ¨è§£å†³</text>
              <text class="col-time">30ç§’</text>
              <text class="col-complexity low">ä½</text>
              <text class="col-success high">95%</text>
            </view>
            <view class="comparison-row">
              <text class="col-strategy">æ‰‹åŠ¨è§£å†³</text>
              <text class="col-time">5-15åˆ†é’Ÿ</text>
              <text class="col-complexity medium">ä¸­</text>
              <text class="col-success high">98%</text>
            </view>
            <view class="comparison-row">
              <text class="col-strategy">è·³è¿‡å¤„ç†</text>
              <text class="col-time">5ç§’</text>
              <text class="col-complexity low">ä½</text>
              <text class="col-success medium">60%</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è‡ªåŠ¨è§£å†³è®¾ç½® -->
      <view wx:if="{{batchConflictPanel.resolutionStrategy === 'auto'}}" class="auto-resolution-settings">
        <view class="settings-title">è‡ªåŠ¨è§£å†³è®¾ç½®</view>
        <view class="setting-group">
          <view class="setting-item">
            <text class="setting-label">åå¥½æ›´æ—©çš„æ—¶é—´</text>
            <switch checked="{{batchConflictPanel.autoResolutionOptions.preferEarlier}}" 
                    data-field="preferEarlier" 
                    bindchange="onAutoResolutionOptionChange" />
          </view>
          
          <view class="setting-item">
            <text class="setting-label">å…è®¸åœ¨å‘¨æœ«å®‰æ’</text>
            <switch checked="{{batchConflictPanel.autoResolutionOptions.allowWeekends}}" 
                    data-field="allowWeekends" 
                    bindchange="onAutoResolutionOptionChange" />
          </view>
          
          <view class="setting-item">
            <text class="setting-label">æœ€å¤§å»¶è¿Ÿå¤©æ•°</text>
            <input class="setting-input" 
                   type="number" 
                   value="{{batchConflictPanel.autoResolutionOptions.maxDaysDelay}}"
                   data-field="maxDaysDelay" 
                   bindinput="onAutoResolutionOptionChange" />
          </view>
        </view>
      </view>

      <!-- æ‰‹åŠ¨è§£å†³è®¾ç½® -->
      <view wx:if="{{batchConflictPanel.resolutionStrategy === 'manual'}}" class="manual-resolution-settings">
        <view class="settings-title">æ‰‹åŠ¨è§£å†³è®¾ç½®</view>
        <view class="manual-options-list">
          <view wx:for="{{batchConflictPanel.manualOptions}}" 
                wx:key="conflictId" 
                class="manual-option-item">
            <view class="conflict-info">
              <text class="conflict-patient">{{item.patientName}}</text>
              <text class="conflict-details">{{item.conflictDetails}}</text>
            </view>
            
            <view class="resolution-options">
              <view wx:for="{{item.options}}" 
                    wx:for-item="option" 
                    wx:key="key" 
                    class="resolution-option {{item.selectedOption === option.key ? 'selected' : ''}}" 
                    data-conflict-id="{{item.conflictId}}" 
                    data-option="{{option.key}}" 
                    bindtap="onManualOptionSelect">
                <text class="option-icon">{{option.icon}}</text>
                <text class="option-label">{{option.label}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- è·³è¿‡è§£å†³è¯´æ˜ -->
      <view wx:if="{{batchConflictPanel.resolutionStrategy === 'skip'}}" class="skip-resolution-info">
        <view class="info-title">è·³è¿‡è§£å†³è¯´æ˜</view>
        <view class="info-content">
          <text>é€‰æ‹©è·³è¿‡è§£å†³å°†ï¼š</text>
          <view class="info-list">
            <text class="info-item">â€¢ ä¿ç•™æ‰€æœ‰æ— å†²çªçš„é¢„çº¦è°ƒæ•´</text>
            <text class="info-item">â€¢ è·³è¿‡æ‰€æœ‰æœ‰å†²çªçš„é¢„çº¦è°ƒæ•´</text>
            <text class="info-item">â€¢ ä¿æŒåŸæœ‰æ—¶é—´ä¸å˜</text>
          </view>
        </view>
      </view>

      <!-- å¢å¼ºçš„å†²çªè¯¦æƒ…åˆ—è¡¨ -->
      <view class="enhanced-conflict-details-list">
        <view class="details-header">
          <text class="details-title">ğŸ” å†²çªè¯¦æƒ…åˆ†æ</text>
          <view class="details-controls">
            <button class="detail-btn" bindtap="onSortConflictsBySeverity">
              <text class="btn-icon">ğŸ”„</text>
              <text class="btn-text">æŒ‰ä¸¥é‡ç¨‹åº¦æ’åº</text>
            </button>
            <button class="detail-btn" bindtap="onFilterConflictsByType">
              <text class="btn-icon">ğŸ”</text>
              <text class="btn-text">ç­›é€‰</text>
            </button>
          </view>
        </view>
        
        <view class="enhanced-conflict-items">
          <view wx:for="{{batchConflictPanel.sortedConflicts}}" 
                wx:key="scheduleId" 
                class="enhanced-conflict-item {{item.severity}}">
            
            <!-- å†²çªçº§åˆ«æŒ‡ç¤ºå™¨ -->
            <view class="conflict-severity-indicator">
              <view class="severity-dot {{item.severity}}">
                <text class="severity-icon">{{item.severityIcon}}</text>
              </view>
              <view class="severity-info">
                <text class="severity-level">{{item.severityText}}</text>
                <text class="severity-score">è¯„åˆ†: {{item.severityScore}}/100</text>
              </view>
            </view>
            
            <!-- å†²çªä¸»ä½“ä¿¡æ¯ -->
            <view class="enhanced-conflict-header">
              <view class="patient-info-enhanced">
                <view class="patient-avatar">
                  <text class="avatar-text">{{item.patientName.substring(0,1)}}</text>
                </view>
                <view class="patient-details">
                  <text class="patient-name">{{item.patientName}}</text>
                  <view class="patient-tags">
                    <view class="conflict-type-badge {{item.type}}">
                      <text class="badge-icon">{{item.type === 'internal' ? 'ğŸ”„' : 'ğŸ”—'}}</text>
                      <text class="badge-text">{{item.type === 'internal' ? 'å†…éƒ¨å†²çª' : 'å¤–éƒ¨å†²çª'}}</text>
                    </view>
                    <view wx:if="{{item.priority}}" class="priority-badge {{item.priority}}">
                      <text class="priority-text">{{item.priorityText}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- å†²çªçŠ¶æ€æŒ‡ç¤º -->
              <view class="conflict-status">
                <view class="status-indicator {{item.resolutionStatus || 'pending'}}">
                  <text class="status-text">{{item.resolutionStatusText || 'å¾…å¤„ç†'}}</text>
                </view>
              </view>
            </view>
            
            <!-- æ—¶é—´å†²çªå¯¹æ¯” -->
            <view class="enhanced-time-comparison">
              <view class="time-section original">
                <text class="time-label">åŸå®šæ—¶é—´</text>
                <view class="time-display">
                  <text class="time-value">{{item.originalTime}}</text>
                  <text class="time-date">{{item.originalDate}}</text>
                </view>
              </view>
              
              <view class="time-arrow-section">
                <view class="conflict-arrow">
                  <text class="arrow-symbol">â†’</text>
                  <view class="conflict-warning">
                    <text class="warning-icon">âš ï¸</text>
                  </view>
                </view>
              </view>
              
              <view class="time-section new">
                <text class="time-label">è°ƒæ•´æ—¶é—´</text>
                <view class="time-display conflict">
                  <text class="time-value">{{item.newTime}}</text>
                  <text class="time-date">{{item.newDate}}</text>
                </view>
              </view>
            </view>
            
            <!-- å†²çªè¯¦ç»†æè¿° -->
            <view class="enhanced-conflict-description">
              <view class="description-header">
                <text class="description-title">å†²çªåŸå› åˆ†æ</text>
                <button class="expand-btn" data-conflict-id="{{item.scheduleId}}" bindtap="onToggleConflictDetails">
                  <text class="expand-icon">{{item.expanded ? 'â–²' : 'â–¼'}}</text>
                </button>
              </view>
              
              <view class="description-content">
                <text class="main-description">{{item.details}}</text>
                
                <view wx:if="{{item.expanded}}" class="detailed-analysis">
                  <view class="analysis-item">
                    <text class="analysis-label">å†²çªç±»å‹:</text>
                    <text class="analysis-value">{{item.conflictTypeDescription}}</text>
                  </view>
                  
                  <view class="analysis-item">
                    <text class="analysis-label">å½±å“èŒƒå›´:</text>
                    <text class="analysis-value">{{item.impactScope}}</text>
                  </view>
                  
                  <view wx:if="{{item.conflictWith && item.conflictWith.length > 0}}" class="analysis-item">
                    <text class="analysis-label">å†²çªå¯¹è±¡:</text>
                    <view class="conflict-targets">
                      <view wx:for="{{item.conflictWith}}" wx:for-item="target" wx:key="*this" class="conflict-target">
                        <text class="target-name">{{target.patientName}}</text>
                        <text class="target-time">{{target.time}}</text>
                      </view>
                    </view>
                  </view>
                  
                  <view class="analysis-item">
                    <text class="analysis-label">å»ºè®®æ–¹æ¡ˆ:</text>
                    <view class="suggestion-list">
                      <view wx:for="{{item.suggestions}}" wx:for-item="suggestion" wx:key="*this" class="suggestion-item">
                        <text class="suggestion-icon">â€¢</text>
                        <text class="suggestion-text">{{suggestion}}</text>
                      </view>
                    </view>
                  </view>
                </view>
              </view>
            </view>
            
            <!-- å†²çªæ“ä½œå¿«æ·é”® -->
            <view class="conflict-quick-actions">
              <button class="quick-action-btn priority" 
                      data-conflict-id="{{item.scheduleId}}" 
                      data-action="reschedule" 
                      bindtap="onQuickConflictAction">
                <text class="action-icon">ğŸ“</text>
                <text class="action-text">é‡æ–°å®‰æ’</text>
              </button>
              
              <button class="quick-action-btn secondary" 
                      data-conflict-id="{{item.scheduleId}}" 
                      data-action="skip" 
                      bindtap="onQuickConflictAction">
                <text class="action-icon">â­ï¸</text>
                <text class="action-text">è·³è¿‡å¤„ç†</text>
              </button>
              
              <button wx:if="{{item.canForce}}" 
                      class="quick-action-btn warning" 
                      data-conflict-id="{{item.scheduleId}}" 
                      data-action="force" 
                      bindtap="onQuickConflictAction">
                <text class="action-icon">âš ï¸</text>
                <text class="action-text">å¼ºåˆ¶æ‰§è¡Œ</text>
              </button>
            </view>
          </view>
          
          <!-- æ— å†²çªæ˜¾ç¤º -->
          <view wx:if="{{batchConflictPanel.conflicts.length === 0}}" class="no-conflicts-state">
            <view class="no-conflicts-icon">âœ¨</view>
            <text class="no-conflicts-title">æ²¡æœ‰æ£€æµ‹åˆ°å†²çª</text>
            <text class="no-conflicts-desc">æ‰€æœ‰æ‰¹é‡è°ƒæ•´é¡¹ç›®éƒ½å¯ä»¥å®‰å…¨æ‰§è¡Œ</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="conflict-actions">
        <button class="btn-secondary" bindtap="closeBatchConflictPanel">å–æ¶ˆ</button>
        <button class="btn-primary" bindtap="executeConflictResolution">æ‰§è¡Œè§£å†³</button>
      </view>
      
    </view>
  </modal>

  <!-- æ‰¹é‡è°ƒæ•´æ“ä½œé¢æ¿ -->
  <modal wx:if="{{batchAdjustPanel.visible}}" show="{{batchAdjustPanel.visible}}" title="æ‰¹é‡æ—¶é—´è°ƒæ•´" custom-class="batch-adjust-modal">
    <view class="batch-adjust-panel">
      
      <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
      <view class="step-indicator">
        <view class="step-item {{batchAdjustPanel.currentStep >= 1 ? 'active' : ''}} {{batchAdjustPanel.currentStep === 1 ? 'current' : ''}}">
          <view class="step-number">1</view>
          <text class="step-label">é€‰æ‹©æ–¹å¼</text>
        </view>
        <view class="step-line {{batchAdjustPanel.currentStep >= 2 ? 'active' : ''}}"></view>
        <view class="step-item {{batchAdjustPanel.currentStep >= 2 ? 'active' : ''}} {{batchAdjustPanel.currentStep === 2 ? 'current' : ''}}">
          <view class="step-number">2</view>
          <text class="step-label">è®¾ç½®å‚æ•°</text>
        </view>
        <view class="step-line {{batchAdjustPanel.currentStep >= 3 ? 'active' : ''}}"></view>
        <view class="step-item {{batchAdjustPanel.currentStep >= 3 ? 'active' : ''}} {{batchAdjustPanel.currentStep === 3 ? 'current' : ''}}">
          <view class="step-number">3</view>
          <text class="step-label">å†²çªæ£€æµ‹</text>
        </view>
        <view class="step-line {{batchAdjustPanel.currentStep >= 4 ? 'active' : ''}}"></view>
        <view class="step-item {{batchAdjustPanel.currentStep >= 4 ? 'active' : ''}} {{batchAdjustPanel.currentStep === 4 ? 'current' : ''}}">
          <view class="step-number">4</view>
          <text class="step-label">ç¡®è®¤æ‰§è¡Œ</text>
        </view>
      </view>

      <!-- æ­¥éª¤1ï¼šé€‰æ‹©è°ƒæ•´æ–¹å¼ -->
      <view wx:if="{{batchAdjustPanel.currentStep === 1}}" class="step-content step-adjust-type">
        <view class="section-title">
          <text class="title-text">é€‰æ‹©è°ƒæ•´æ–¹å¼</text>
          <text class="title-subtitle">ä¸º {{batchAdjustPanel.totalCount}} ä¸ªé¢„çº¦é€‰æ‹©æ—¶é—´è°ƒæ•´æ–¹å¼</text>
        </view>
        
        <view class="adjust-type-grid">
          <view class="adjust-type-card" data-type="uniform" bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">â°</view>
            <view class="type-info">
              <text class="type-title">ç»Ÿä¸€è°ƒæ•´</text>
              <text class="type-desc">å°†æ‰€æœ‰é¢„çº¦ç»Ÿä¸€å»¶åæˆ–è°ƒæ•´åˆ°æŒ‡å®šæ—¶é—´</text>
            </view>
            <view class="type-features">
              <text class="feature-item">â€¢ ç»Ÿä¸€å»¶åXå°æ—¶/å¤©</text>
              <text class="feature-item">â€¢ å›ºå®šåˆ°æŒ‡å®šæ—¶é—´</text>
            </view>
          </view>
          
          <view class="adjust-type-card" data-type="staggered" bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ“Š</view>
            <view class="type-info">
              <text class="type-title">é”™å¼€è°ƒæ•´</text>
              <text class="type-desc">æŒ‰æ—¶é—´é—´éš”ä¾æ¬¡å®‰æ’ï¼Œé¿å…æ—¶é—´å†²çª</text>
            </view>
            <view class="type-features">
              <text class="feature-item">â€¢ æŒ‰é—´éš”è‡ªåŠ¨æ’åˆ—</text>
              <text class="feature-item">â€¢ æ”¯æŒå¤šç§æ’åºè§„åˆ™</text>
            </view>
          </view>
          
          <view class="adjust-type-card" data-type="smart" bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ¤–</view>
            <view class="type-info">
              <text class="type-title">æ™ºèƒ½è°ƒæ•´</text>
              <text class="type-desc">åŸºäºè·ç¦»ã€ä¼˜å…ˆçº§ç­‰å› ç´ æ™ºèƒ½å®‰æ’</text>
            </view>
            <view class="type-features">
              <text class="feature-item">â€¢ è€ƒè™‘åœ°ç†ä½ç½®</text>
              <text class="feature-item">â€¢ ä¼˜åŒ–è·¯çº¿å®‰æ’</text>
            </view>
          </view>
          
          <view class="adjust-type-card" data-type="proportion" bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ“ˆ</view>
            <view class="type-info">
              <text class="type-title">æŒ‰æ¯”ä¾‹è°ƒæ•´</text>
              <text class="type-desc">æ ¹æ®ä¼˜å…ˆçº§æŒ‰æ¯”ä¾‹åˆ†é…æ—¶é—´æ®µ</text>
            </view>
            <view class="type-features">
              <text class="feature-item">â€¢ ä¼˜å…ˆçº§æ¯”ä¾‹åˆ†é…</text>
              <text class="feature-item">â€¢ è‡ªå®šä¹‰æ¯”ä¾‹è®¾ç½®</text>
            </view>
          </view>
          
          <view class="adjust-type-card" data-type="template" bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ“‹</view>
            <view class="type-info">
              <text class="type-title">æ¨¡æ¿è°ƒæ•´</text>
              <text class="type-desc">ä½¿ç”¨é¢„è®¾æ¨¡æ¿å¿«é€Ÿè°ƒæ•´</text>
            </view>
            <view class="type-features">
              <text class="feature-item">â€¢ é¢„è®¾è°ƒæ•´æ–¹æ¡ˆ</text>
              <text class="feature-item">â€¢ ä¸€é”®åº”ç”¨æ¨¡æ¿</text>
            </view>
          </view>
          
          <view class="adjust-type-card" data-type="custom" bindtap="onBatchAdjustTypeSelect">
            <view class="type-icon">ğŸ”§</view>
            <view class="type-info">
              <text class="type-title">è‡ªå®šä¹‰è°ƒæ•´</text>
              <text class="type-desc">è‡ªå®šä¹‰è°ƒæ•´è§„åˆ™å’Œæ¡ä»¶</text>
            </view>
            <view class="type-features">
              <text class="feature-item">â€¢ çµæ´»è‡ªå®šä¹‰è§„åˆ™</text>
              <text class="feature-item">â€¢ å¤æ‚æ¡ä»¶è®¾ç½®</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
      <view class="panel-actions">
        <view wx:if="{{batchAdjustPanel.currentStep > 1}}" 
              class="action-btn secondary" 
              data-action="prev" 
              bindtap="onBatchAdjustStep">
          <text>ä¸Šä¸€æ­¥</text>
        </view>
        
        <view wx:if="{{batchAdjustPanel.currentStep < 4}}" 
              class="action-btn primary" 
              data-action="next" 
              bindtap="onBatchAdjustStep">
          <text>ä¸‹ä¸€æ­¥</text>
        </view>
        
        <view wx:if="{{batchAdjustPanel.currentStep === 4}}" 
              class="action-btn primary execute" 
              bindtap="executeBatchAdjustment">
          <text>æ‰§è¡Œè°ƒæ•´</text>
        </view>
        
        <view class="action-btn cancel" bindtap="closeBatchAdjustPanel">
          <text>å–æ¶ˆ</text>
        </view>
      </view>
      
    </view>
  </modal>
</view>