<!-- pages/forgot-password/forgot-password.wxml -->
<view class="forgot-password-container">
  <!-- 页面头部 -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <image src="/images/icons/back.png" class="back-icon" mode="aspectFit"></image>
    </view>
    <view class="title">找回密码</view>
  </view>

  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step-item {{step >= 1 ? 'active' : ''}}">
      <view class="step-number {{step >= 1 ? 'active' : ''}}">1</view>
      <view class="step-label">验证手机号</view>
    </view>
    <view class="step-line {{step >= 2 ? 'active' : ''}}"></view>
    <view class="step-item {{step >= 2 ? 'active' : ''}}">
      <view class="step-number {{step >= 2 ? 'active' : ''}}">2</view>
      <view class="step-label">验证身份</view>
    </view>
    <view class="step-line {{step >= 3 ? 'active' : ''}}"></view>
    <view class="step-item {{step >= 3 ? 'active' : ''}}">
      <view class="step-number {{step >= 3 ? 'active' : ''}}">3</view>
      <view class="step-label">重置密码</view>
    </view>
  </view>

  <!-- 表单内容 -->
  <view class="form-container">
    
    <!-- 第一步：输入手机号 -->
    <view wx:if="{{step === 1}}" class="step-content">
      <view class="step-title">验证手机号</view>
      <view class="step-desc">请输入您注册时使用的手机号</view>
      
      <form-item
        type="input"
        label="手机号"
        placeholder="请输入手机号"
        value="{{phone}}"
        error="{{phoneError}}"
        required="{{true}}"
        maxlength="11"
        bind:input="onPhoneInput"
        bind:blur="onPhoneBlur">
        <view slot="suffix" wx:if="{{phone}}" class="clear-btn" bindtap="clearPhone">
          <image src="/images/icons/clear.png" class="clear-icon" mode="aspectFit"></image>
        </view>
      </form-item>

      <view class="button-group">
        <custom-button
          type="primary"
          size="large"
          disabled="{{!phone || phoneError}}"
          bindtap="nextStep">
          下一步
        </custom-button>
      </view>
    </view>

    <!-- 第二步：输入验证码 -->
    <view wx:if="{{step === 2}}" class="step-content">
      <view class="step-title">验证身份</view>
      <view class="step-desc">验证码已发送至 {{phone}}</view>
      
      <form-item
        type="input"
        label="验证码"
        placeholder="请输入6位验证码"
        value="{{smsCode}}"
        error="{{smsCodeError}}"
        required="{{true}}"
        maxlength="6"
        bind:input="onSmsCodeInput">
        <view slot="suffix" class="sms-btn-wrapper">
          <view
            class="sms-btn {{canSendSms ? 'active' : ''}}"
            bindtap="sendSmsCode">
            <text wx:if="{{smsCountdown === 0}}">{{sendingSms ? '发送中...' : '获取验证码'}}</text>
            <text wx:else>{{smsCountdown}}s后重新发送</text>
          </view>
        </view>
      </form-item>

      <view class="button-group">
        <custom-button
          type="default"
          size="large"
          bindtap="prevStep">
          上一步
        </custom-button>
        <custom-button
          type="primary"
          size="large"
          disabled="{{!canVerifyPhone}}"
          loading="{{verifyingPhone}}"
          bindtap="verifyPhone">
          验证
        </custom-button>
      </view>
    </view>

    <!-- 第三步：设置新密码 -->
    <view wx:if="{{step === 3}}" class="step-content">
      <view class="step-title">重置密码</view>
      <view class="step-desc">请设置新的登录密码</view>
      
      <form-item
        type="input"
        label="新密码"
        placeholder="请输入新密码"
        value="{{newPassword}}"
        error="{{passwordError}}"
        required="{{true}}"
        password="{{!showPassword}}"
        maxlength="20"
        bind:input="onNewPasswordInput">
        <view slot="suffix" class="password-toggle" bindtap="togglePassword">
          <image 
            src="/images/icons/{{showPassword ? 'eye-open' : 'eye-close'}}.png" 
            class="eye-icon" 
            mode="aspectFit">
          </image>
        </view>
      </form-item>

      <form-item
        type="input"
        label="确认密码"
        placeholder="请再次输入新密码"
        value="{{confirmPassword}}"
        error="{{confirmPasswordError}}"
        required="{{true}}"
        password="{{!showConfirmPassword}}"
        maxlength="20"
        bind:input="onConfirmPasswordInput">
        <view slot="suffix" class="password-toggle" bindtap="toggleConfirmPassword">
          <image 
            src="/images/icons/{{showConfirmPassword ? 'eye-open' : 'eye-close'}}.png" 
            class="eye-icon" 
            mode="aspectFit">
          </image>
        </view>
      </form-item>

      <view class="password-rules">
        <view class="rules-title">密码要求：</view>
        <view class="rule-item">• 长度为6-20位字符</view>
        <view class="rule-item">• 建议包含字母和数字的组合</view>
      </view>

      <view class="button-group">
        <custom-button
          type="default"
          size="large"
          bindtap="prevStep">
          上一步
        </custom-button>
        <custom-button
          type="primary"
          size="large"
          disabled="{{!canResetPassword}}"
          loading="{{resettingPassword}}"
          bindtap="resetPassword">
          重置密码
        </custom-button>
      </view>
    </view>
  </view>

  <!-- 底部提示 -->
  <view class="footer">
    <view class="footer-text">
      如遇问题，请联系客服：400-123-4567
    </view>
  </view>
</view>