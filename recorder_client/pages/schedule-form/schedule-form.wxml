<!--æ—¥ç¨‹è¡¨å•é¡µé¢-->
<view class="schedule-form-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view wx:else class="form-content">
    <scroll-view scroll-y class="form-scroll">
      
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="form-section">
        <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
        
        <!-- æœåŠ¡åç§° -->
        <form-item 
          label="æœåŠ¡åç§°" 
          required="{{false}}"
          error="{{formErrors.serviceName}}">
          <input 
            class="form-input"
            data-field="serviceName"
            value="{{formData.serviceName}}"
            placeholder="è¯·è¾“å…¥æœåŠ¡åç§°"
            bindinput="onInputChange" />
        </form-item>

        <!-- æ‚£è€…é€‰æ‹© -->
        <form-item 
          label="æœåŠ¡å¯¹è±¡" 
          required="{{false}}"
          error="{{formErrors.patientId}}">
          <picker 
            data-field="patientId"
            range="{{patientList}}"
            range-key="name"
            value="{{formData.patientName}}"
            bindchange="onPatientChange">
            <view class="picker-display">
              {{formData.patientName || 'è¯·é€‰æ‹©æ‚£è€…'}}
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </form-item>

        <!-- æœåŠ¡ç±»å‹ -->
        <form-item 
          label="æœåŠ¡ç±»å‹" 
          required="{{false}}"
          error="{{formErrors.serviceType}}">
          <picker 
            data-field="serviceType"
            range="{{serviceTypes}}"
            range-key="label"
            bindchange="onServiceTypeChange">
            <view class="picker-display">
              {{selectedServiceTypeLabel || 'è¯·é€‰æ‹©æœåŠ¡ç±»å‹'}}
              <text class="picker-arrow">&gt;</text>
            </view>
          </picker>
        </form-item>

        <!-- ä¼˜å…ˆçº§ -->
        <form-item 
          label="ä¼˜å…ˆçº§" 
          required="{{false}}"
          error="{{formErrors.priority}}">
          <picker 
            data-field="priority"
            range="{{priorities}}"
            range-key="label"
            bindchange="onPriorityChange">
            <view class="picker-display">
              <view class="priority-item">
                <text 
                  class="priority-dot" 
                  style="background-color: {{selectedPriorityColor}}">
                </text>
                {{selectedPriorityLabel || 'è¯·é€‰æ‹©ä¼˜å…ˆçº§'}}
              </view>
              <text class="picker-arrow">&gt;</text>
            </view>
          </picker>
        </form-item>
      </view>

      <!-- æ—¶é—´å®‰æ’ -->
      <view class="form-section">
        <view class="section-title">æ—¶é—´å®‰æ’</view>
        
        <!-- å¼€å§‹æ—¶é—´ -->
        <form-item 
          label="å¼€å§‹æ—¶é—´" 
          required="{{true}}"
          error="{{formErrors.startTime}}">
          <picker 
            mode="multiSelector"
            range="{{dateTimePickerRange}}"
            range-key="{{dateTimePickerRangeKey}}"
            value="{{startTimePickerValue}}"
            data-field="startTime"
            bindchange="onDateTimePickerChange">
            <view class="picker-display">
              <text class="datetime-text">{{formData.startTime || 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´'}}</text>
              <text class="picker-arrow">&gt;</text>
            </view>
          </picker>
        </form-item>

        <!-- ç»“æŸæ—¶é—´ -->
        <form-item 
          label="ç»“æŸæ—¶é—´" 
          required="{{true}}"
          error="{{formErrors.endTime}}">
          <picker 
            mode="multiSelector"
            range="{{dateTimePickerRange}}"
            range-key="{{dateTimePickerRangeKey}}"
            value="{{endTimePickerValue}}"
            data-field="endTime"
            bindchange="onDateTimePickerChange">
            <view class="picker-display">
              <text class="datetime-text">{{formData.endTime || 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´'}}</text>
              <text class="picker-arrow">&gt;</text>
            </view>
          </picker>
        </form-item>
      </view>

      <!-- è¯¦ç»†ä¿¡æ¯ -->
      <view class="form-section">
        <view class="section-title">è¯¦ç»†ä¿¡æ¯</view>
        
        <!-- æœåŠ¡åœ°ç‚¹ -->
        <form-item 
          label="æœåŠ¡åœ°ç‚¹" 
          required="{{false}}"
          error="{{formErrors.location}}">
          <input 
            class="form-input"
            data-field="location"
            value="{{formData.location}}"
            placeholder="è¯·è¾“å…¥æœåŠ¡åœ°ç‚¹"
            bindinput="onInputChange" />
        </form-item>

        <!-- æœåŠ¡æè¿° -->
        <form-item 
          label="æœåŠ¡æè¿°" 
          required="{{false}}"
          error="{{formErrors.description}}">
          <textarea 
            class="form-textarea"
            data-field="description"
            value="{{formData.description}}"
            placeholder="è¯·è¾“å…¥æœåŠ¡æè¿°æˆ–å¤‡æ³¨ä¿¡æ¯"
            bindinput="onInputChange"
            maxlength="200"
            show-count>
          </textarea>
        </form-item>
      </view>

    </scroll-view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="form-actions">
      <button 
        class="btn-cancel"
        hover-class="btn-cancel-hover"
        bindtap="onCancel">
        <text class="btn-icon">âŒ</text>
        <text class="btn-text">å–æ¶ˆ</text>
      </button>
      <button 
        class="btn-submit {{submitting ? 'submitting' : ''}}"
        hover-class="btn-submit-hover"
        bindtap="onSubmit"
        disabled="{{submitting}}">
        <text class="btn-icon">{{submitting ? 'â³' : (mode === 'create' ? 'â•' : 'ğŸ’¾')}}</text>
        <text class="btn-text">{{submitting ? 'æäº¤ä¸­...' : (mode === 'create' ? 'åˆ›å»º' : 'ä¿å­˜')}}</text>
      </button>
    </view>
  </view>
</view>