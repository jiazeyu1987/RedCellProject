<!--pages/login/login.wxml-->
<view class="login-container">
  <!-- 顶部logo区域 -->
  <view class="logo-section">
    <view class="logo-image">
      <image src="/assets/logo.png" mode="aspectFit" class="logo"></image>
    </view>
    <view class="app-name">记录员助手</view>
    <view class="app-desc">专业家庭健康服务记录平台</view>
  </view>

  <!-- 登录表单区域 -->
  <view class="form-section">
    <!-- 登录方式切换 -->
    <view class="login-tabs">
      <view class="tab-item {{loginType === 'password' ? 'active' : ''}}" bindtap="switchLoginType" data-type="password">
        <text>密码登录</text>
      </view>
      <view class="tab-item {{loginType === 'sms' ? 'active' : ''}}" bindtap="switchLoginType" data-type="sms">
        <text>验证码登录</text>
      </view>
    </view>
    <!-- 手机号输入 -->
    <view class="input-group {{phoneError ? 'error' : ''}}">
      <view class="input-wrapper">
        <view class="input-icon">
          <image src="/assets/icons/phone.png" class="icon"></image>
        </view>
        <input 
          class="input-field" 
          type="number" 
          placeholder="请输入手机号" 
          value="{{phone}}"
          bindinput="onPhoneInput"
          bindfocus="onPhoneFocus"
          bindblur="onPhoneBlur"
          maxlength="11"
        />
        <view class="input-action" wx:if="{{phone}}" bindtap="clearPhone">
          <image src="/assets/icons/clear.png" class="icon"></image>
        </view>
      </view>
      <view class="error-text" wx:if="{{phoneError}}">{{phoneError}}</view>
    </view>

    <!-- 密码输入 -->
    <view class="input-group {{passwordError ? 'error' : ''}}" wx:if="{{loginType === 'password'}}">
      <view class="input-wrapper">
        <view class="input-icon">
          <image src="/assets/icons/lock.png" class="icon"></image>
        </view>
        <input 
          class="input-field" 
          type="{{showPassword ? 'text' : 'password'}}" 
          placeholder="请输入密码" 
          value="{{password}}"
          bindinput="onPasswordInput"
          bindfocus="onPasswordFocus"
          bindblur="onPasswordBlur"
        />
        <view class="input-action" bindtap="togglePassword">
          <image src="/assets/icons/{{showPassword ? 'eye-off' : 'eye'}}.png" class="icon"></image>
        </view>
      </view>
      <view class="error-text" wx:if="{{passwordError}}">{{passwordError}}</view>
    </view>

    <!-- 验证码输入 -->
    <view class="input-group {{smsCodeError ? 'error' : ''}}" wx:if="{{loginType === 'sms'}}">
      <view class="input-wrapper">
        <view class="input-icon">
          <image src="/assets/icons/sms.png" class="icon"></image>
        </view>
        <input 
          class="input-field" 
          type="number" 
          placeholder="请输入6位验证码" 
          value="{{smsCode}}"
          bindinput="onSmsCodeInput"
          bindfocus="onSmsCodeFocus"
          bindblur="onSmsCodeBlur"
          maxlength="6"
        />
        <view class="sms-btn {{canSendSms ? 'active' : 'disabled'}}" bindtap="sendSmsCode">
          <text wx:if="{{smsCountdown > 0}}">{{smsCountdown}}s</text>
          <text wx:elif="{{sendingSms}}">发送中...</text>
          <text wx:else>{{isFirstSend ? '获取验证码' : '重新发送'}}</text>
        </view>
      </view>
      <view class="error-text" wx:if="{{smsCodeError}}">{{smsCodeError}}</view>
    </view>

    <!-- 记住密码和忘记密码 -->
    <view class="form-options">
      <view class="remember-section" wx:if="{{loginType === 'password'}}" bindtap="toggleRemember">
        <view class="checkbox {{rememberPassword ? 'checked' : ''}}">
          <image wx:if="{{rememberPassword}}" src="/assets/icons/check.png" class="check-icon"></image>
        </view>
        <text class="remember-text">记住密码</text>
      </view>
      <view class="forgot-section" wx:if="{{loginType === 'password'}}" bindtap="goToForgotPassword">
        <text class="forgot-text">忘记密码？</text>
      </view>
    </view>

    <!-- 登录按钮 -->
    <view class="login-buttons">
      <button 
        class="login-btn {{canLogin && !isLoading ? 'active' : 'disabled'}}" 
        bindtap="login"
        disabled="{{!canLogin || isLoading}}"
      >
        <view wx:if="{{isLoading}}" class="loading">
          <view class="loading-icon"></view>
          <text>登录中...</text>
        </view>
        <text wx:else>登录</text>
      </button>

      <view class="divider">
        <view class="divider-line"></view>
        <text class="divider-text">或</text>
        <view class="divider-line"></view>
      </view>

      <button class="wechat-btn" bindtap="wechatLogin">
        <image src="/assets/icons/wechat.png" class="wechat-icon"></image>
        <text>微信登录</text>
      </button>
      
      <!-- 隐藏的用户信息授权按钮 -->
      <button 
        class="hidden-auth-btn" 
        open-type="getUserInfo" 
        bindgetuserinfo="onGetUserInfo"
        wx:if="{{showAuthButton}}"
      >
        点击授权获取头像和昵称
      </button>
    </view>
  </view>

  <!-- 底部区域 -->
  <view class="footer-section">
    <view class="register-section">
      <text class="register-text">还没有账号？</text>
      <text class="register-link" bindtap="goToRegister">立即注册</text>
    </view>

    <view class="agreement-section">
      <text class="agreement-text">登录即表示同意</text>
      <text class="agreement-link" bindtap="showUserAgreement">《用户协议》</text>
      <text class="agreement-text">和</text>
      <text class="agreement-link" bindtap="showPrivacyPolicy">《隐私政策》</text>
    </view>
  </view>
</view>