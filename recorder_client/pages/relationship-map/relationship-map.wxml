<!--家庭关系图谱详情页面-->
<view class="relationship-map-page">
  <!-- 顶部工具栏 -->
  <view class="page-toolbar">
    <view class="toolbar-left">
      <button class="back-btn" bind:tap="onBack">
        <icon type="back" size="16" color="#333"/>
        <text class="back-text">返回</text>
      </button>
    </view>
    
    <view class="toolbar-center">
      <text class="page-title">家庭关系图谱</text>
      <text class="member-count" wx:if="{{relationshipData}}">
        {{relationshipData.nodes.length}}位成员
      </text>
    </view>
    
    <view class="toolbar-right">
      <button class="tool-btn" bind:tap="onRefresh" wx:if="{{isError}}">
        <icon type="refresh" size="16" color="#4A90E2"/>
      </button>
      <button class="tool-btn" bind:tap="saveChanges" wx:if="{{hasChanges}}">
        <icon type="success" size="16" color="#52c41a"/>
      </button>
      <button class="tool-btn" bind:tap="toggleEditMode">
        <icon type="{{isEditMode ? 'clear' : 'setting'}}" size="16" color="{{isEditMode ? '#ff4d4f' : '#4A90E2'}}"/>
      </button>
    </view>
  </view>

  <!-- 主内容区域 -->
  <view class="page-content">
    <!-- 关系图谱组件 -->
    <view class="map-container" wx:if="{{!loading && !isError && relationshipData}}">
      <family-relationship-map
        id="relationshipMap"
        relationshipData="{{relationshipData}}"
        mode="{{currentMode}}"
        showActions="{{showActions}}"
        selectedMemberId="{{selectedMemberId}}"
        customClass="full-map"
        bind:nodeSelect="onNodeSelect"
        bind:relationshipAdd="onRelationshipAdd"
        bind:relationshipRemove="onRelationshipRemove"
        bind:addMember="onAddMember"
        bind:editMember="onEditMember"
        bind:viewDetails="onViewMemberDetails"
      />
    </view>
    
    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">正在加载关系图谱...</text>
    </view>
    
    <!-- 错误状态 -->
    <view class="error-state" wx:if="{{isError && !loading}}">
      <view class="error-icon">⚠️</view>
      <text class="error-title">加载失败</text>
      <text class="error-subtitle">网络连接异常或数据格式错误</text>
      <button class="error-action" bind:tap="onRefresh">
        重新加载
      </button>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && !isError && (!relationshipData || !relationshipData.nodes.length)}}">
      <view class="empty-icon">👥</view>
      <text class="empty-title">暂无家庭关系数据</text>
      <text class="empty-subtitle">请先添加家庭成员信息</text>
      <button class="empty-action" bind:tap="onAddMember">
        添加成员
      </button>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-actions" wx:if="{{!loading && !isError && relationshipData}}">
    <view class="action-group">
      <button class="action-btn secondary" bind:tap="onResetLayout">
        <icon type="refresh" size="16" color="#666"/>
        <text class="action-text">重置布局</text>
      </button>
      
      <button class="action-btn secondary" bind:tap="onAddMember" wx:if="{{isEditMode}}">
        <icon type="plus" size="16" color="#666"/>
        <text class="action-text">添加成员</text>
      </button>
      
      <button class="action-btn primary" bind:tap="onExportMap">
        <icon type="download" size="16" color="#fff"/>
        <text class="action-text">导出图谱</text>
      </button>
    </view>
  </view>

  <!-- 操作提示浮层 -->
  <view class="operation-tips {{hasChanges ? 'show' : ''}}" wx:if="{{hasChanges}}">
    <view class="tip-content">
      <icon type="info_circle" size="16" color="#fa8c16"/>
      <text class="tip-text">您有未保存的更改</text>
      <button class="tip-action" bind:tap="saveChanges">
        立即保存
      </button>
    </view>
  </view>
</view>