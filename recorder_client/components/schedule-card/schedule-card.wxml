<view class="schedule-card {{customClass}} {{cardType}} {{selected ? 'selected' : ''}} {{processedSchedule.timeStatus}}"
      bindtap="onCardTap">
  
  <!-- é€‰æ‹©çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{selectable}}" class="select-indicator {{selected ? 'selected' : ''}}">
    <text class="select-icon">{{selected ? 'âœ“' : ''}}</text>
  </view>

  <!-- å¡ç‰‡å¤´éƒ¨ -->
  <view class="card-header">
    <!-- å·¦ä¾§æ—¶é—´ä¿¡æ¯ -->
    <view class="time-info">
      <view class="date">{{processedSchedule.timeDisplay.date}}</view>
      <view class="time">{{processedSchedule.timeDisplay.time}}</view>
      <view wx:if="{{processedSchedule.isToday}}" class="today-badge">ä»Šæ—¥</view>
    </view>
    
    <!-- å³ä¾§çŠ¶æ€å’Œä¼˜å…ˆçº§ -->
    <view class="status-info">
      <status-tag 
        status="{{schedule.status}}"
        type="{{schedule.type}}"
        size="small"
        custom-class="schedule-status-tag">
      </status-tag>
      
      <view wx:if="{{schedule.priority !== 'normal'}}" class="priority-tag">
        <text class="priority-icon">{{processedSchedule.priorityIcon}}</text>
        <text class="priority-text">{{processedSchedule.priorityText}}</text>
      </view>
    </view>
  </view>

  <!-- å¡ç‰‡ä¸»ä½“ -->
  <view class="card-body">
    <!-- æ‚£è€…ä¿¡æ¯ -->
    <view class="patient-info">
      <view class="patient-name">
        <text class="name">{{schedule.patient.name}}</text>
        <text wx:if="{{schedule.patient.age}}" class="age">{{schedule.patient.age}}å²</text>
        <text wx:if="{{schedule.patient.gender}}" class="gender">{{schedule.patient.gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
      </view>
      
      <view wx:if="{{schedule.patient.phone}}" class="patient-contact">
        <text class="phone">{{schedule.patient.phone}}</text>
      </view>
    </view>

    <!-- æœåŠ¡ä¿¡æ¯ -->
    <view class="service-info">
      <view class="service-type">
        <text class="type-text">{{processedSchedule.typeText}}</text>
        <text wx:if="{{schedule.serviceItems && schedule.serviceItems.length > 0}}" class="service-count">
          ({{schedule.serviceItems.length}}é¡¹æœåŠ¡)
        </text>
      </view>
      
      <view wx:if="{{schedule.description}}" class="service-description">
        {{schedule.description}}
      </view>
    </view>

    <!-- åœ°å€ä¿¡æ¯ -->
    <view wx:if="{{schedule.address}}" class="address-info">
      <text class="address-icon">ğŸ“</text>
      <text class="address-text">{{schedule.address.detail || schedule.address.name}}</text>
    </view>

    <!-- ç‰¹æ®Šæé†’ -->
    <view wx:if="{{schedule.notes || processedSchedule.isOverdue}}" class="special-notes">
      <view wx:if="{{processedSchedule.isOverdue}}" class="overdue-notice">
        âš ï¸ å·²è¿‡æœŸ
      </view>
      <view wx:if="{{schedule.notes}}" class="notes">
        ğŸ’¡ {{schedule.notes}}
      </view>
    </view>
  </view>

  <!-- å¡ç‰‡åº•éƒ¨æ“ä½œåŒº -->
  <view wx:if="{{showActions && !selectable}}" class="card-actions">
    <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
    <view class="quick-actions">
      <!-- è”ç³»æ‚£è€… -->
      <view wx:if="{{schedule.patient.phone}}" 
            class="action-btn contact-btn"
            bindtap="onContactPatient">
        <text class="action-icon">ğŸ“</text>
        <text class="action-text">è”ç³»</text>
      </view>
      
      <!-- å¯¼èˆª -->
      <view wx:if="{{schedule.address && schedule.address.latitude}}" 
            class="action-btn navigate-btn"
            bindtap="onNavigateToPatient">
        <text class="action-icon">ğŸ§­</text>
        <text class="action-text">å¯¼èˆª</text>
      </view>
      
      <!-- å¼€å§‹æœåŠ¡ï¼ˆä»…åœ¨ç‰¹å®šçŠ¶æ€ä¸‹æ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{schedule.status === 'confirmed' || schedule.status === 'pending'}}" 
            class="action-btn start-btn"
            bindtap="onStartService">
        <text class="action-icon">â–¶ï¸</text>
        <text class="action-text">å¼€å§‹</text>
      </view>
      
      <!-- æ›´å¤šæ“ä½œ -->
      <view class="action-btn more-btn"
            data-action="more"
            bindtap="onActionTap">
        <text class="action-icon">â‹¯</text>
        <text class="action-text">æ›´å¤š</text>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´çŠ¶æ€æŒ‡ç¤ºæ¡ -->
  <view class="time-status-bar {{processedSchedule.timeStatus}}"></view>
</view>