<!--æ„è§åé¦ˆé¡µé¢-->
<view class="container">
  <!-- åé¦ˆè¡¨å• -->
  <view class="feedback-form">
    <view class="form-header">
      <text class="form-title">ğŸ“ æ„è§åé¦ˆ</text>
      <text class="form-desc">æ‚¨çš„æ„è§æ˜¯æˆ‘ä»¬å‰è¿›çš„åŠ¨åŠ›</text>
    </view>

    <!-- åé¦ˆç±»å‹é€‰æ‹© -->
    <view class="form-section">
      <text class="section-title">åé¦ˆç±»å‹</text>
      <view class="type-grid">
        <view wx:for="{{feedbackTypes}}" wx:key="value" 
              class="type-item {{selectedType === item.value ? 'selected' : ''}}"
              bind:tap="selectFeedbackType" data-type="{{item.value}}">
          <text class="type-icon">{{item.icon}}</text>
          <text class="type-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- åé¦ˆå†…å®¹ -->
    <view class="form-section">
      <text class="section-title">è¯¦ç»†æè¿°</text>
      <textarea class="feedback-textarea" 
                placeholder="è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜æˆ–å»ºè®®ï¼Œè‡³å°‘10ä¸ªå­—ç¬¦..."
                value="{{feedbackContent}}" 
                bind:input="onContentInput"
                maxlength="500"
                show-confirm-bar="{{false}}"></textarea>
      <view class="char-count">{{feedbackContent.length}}/500</view>
    </view>

    <!-- å›¾ç‰‡ä¸Šä¼  -->
    <view class="form-section">
      <text class="section-title">ç›¸å…³å›¾ç‰‡ (å¯é€‰)</text>
      <view class="image-upload">
        <view wx:for="{{images}}" wx:key="*this" class="image-item">
          <image class="upload-image" src="{{item}}" mode="aspectFill" 
                 bind:tap="previewImage" data-src="{{item}}"></image>
          <view class="image-delete" bind:tap="deleteImage" data-index="{{index}}">
            <text class="delete-icon">âœ•</text>
          </view>
        </view>
        <view wx:if="{{images.length < 9}}" class="upload-btn" bind:tap="chooseImage">
          <text class="upload-icon">ğŸ“·</text>
          <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
        </view>
      </view>
      <view class="upload-tip">æœ€å¤šå¯ä¸Šä¼ 9å¼ å›¾ç‰‡</view>
    </view>

    <!-- è”ç³»æ–¹å¼ -->
    <view class="form-section">
      <text class="section-title">è”ç³»æ–¹å¼ (å¯é€‰)</text>
      <input class="contact-input" 
             placeholder="è¯·è¾“å…¥æ‰‹æœºå·ã€é‚®ç®±æˆ–QQå·ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸æ‚¨è”ç³»"
             value="{{contactInfo}}" 
             bind:input="onContactInput" />
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button class="submit-btn {{submitting ? 'submitting' : ''}}" 
              bind:tap="submitFeedback" 
              disabled="{{submitting}}">
        <text wx:if="{{submitting}}">æäº¤ä¸­...</text>
        <text wx:else>æäº¤åé¦ˆ</text>
      </button>
      
      <button class="contact-service-btn" bind:tap="contactCustomerService">
        <text class="service-icon">ğŸ“</text>
        <text>è”ç³»å®¢æœ</text>
      </button>
    </view>
  </view>

  <!-- åé¦ˆå†å² -->
  <view wx:if="{{feedbackHistory.length > 0}}" class="history-section">
    <view class="section-header">
      <text class="section-title">å†å²åé¦ˆ</text>
      <text class="history-count">{{feedbackHistory.length}}æ¡</text>
    </view>

    <view class="history-list">
      <view wx:for="{{feedbackHistory}}" wx:key="id" 
            class="history-item" 
            bind:tap="viewFeedbackDetail" 
            data-feedback="{{item}}">
        <view class="history-header">
          <view class="history-type">
            <text class="type-icon">{{getFeedbackTypeIcon(item.type)}}</text>
            <text class="type-text">{{item.typeName}}</text>
          </view>
          <view class="history-actions">
            <text class="history-time">{{formatDate(item.submitTime)}}</text>
            <button class="delete-history-btn" 
                    bind:tap="deleteFeedback" 
                    data-id="{{item.id}}" 
                    catch:tap="true">
              âœ•
            </button>
          </view>
        </view>
        
        <view class="history-content">{{item.content}}</view>
        
        <view class="history-footer">
          <view class="history-status status-{{item.status}}">
            <text>{{getStatusText(item.status)}}</text>
          </view>
          <view wx:if="{{item.imageCount > 0}}" class="image-count">
            <text class="image-icon">ğŸ“·</text>
            <text>{{item.imageCount}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{feedbackHistory.length === 0}}" class="empty-history">
    <text class="empty-icon">ğŸ“­</text>
    <text class="empty-text">æš‚æ— åé¦ˆè®°å½•</text>
    <text class="empty-desc">æ‚¨çš„ç¬¬ä¸€æ¡åé¦ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
  </view>

  <!-- åº•éƒ¨è¯´æ˜ -->
  <view class="footer-note">
    <text class="note-text">ğŸ’¡ æˆ‘ä»¬æ‰¿è¯ºåœ¨3ä¸ªå·¥ä½œæ—¥å†…å›å¤æ‚¨çš„åé¦ˆ</text>
    <text class="note-text">ğŸ”’ æ‚¨çš„ä¸ªäººä¿¡æ¯å°†å—åˆ°ä¸¥æ ¼ä¿æŠ¤</text>
  </view>
</view>