<!--å®¶åº­æˆå‘˜ç®¡ç†é¡µé¢-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-info">
      <text class="member-count">å…±{{members.length}}ä½å®¶åº­æˆå‘˜</text>
      <text class="header-desc">ç®¡ç†æ‚¨çš„å®¶åº­æˆå‘˜ä¿¡æ¯ï¼Œä¸ºä»–ä»¬é¢„çº¦åŒ»ç–—æœåŠ¡</text>
    </view>
    <button class="add-member-btn" bind:tap="showAddMemberModal">
      <text class="add-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</text>
      <text>æ·»åŠ æˆå‘˜</text>
    </button>
  </view>

  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view class="members-section">
    <view wx:for="{{members}}" wx:key="id" class="member-card" bind:tap="viewMemberDetail" data-member="{{item}}">
      <view class="member-avatar">
        <text class="avatar-emoji">{{item.avatar}}</text>
      </view>

      <view class="member-info">
        <view class="member-name">{{item.name}}</view>
        <view class="member-details">
          <text class="member-relation">{{getRelationName(item.relation)}}</text>
          <text class="member-age">{{item.age}}å²</text>
          <text class="member-gender">{{getGenderName(item.gender)}}</text>
        </view>
        <view wx:if="{{item.medicalHistory}}" class="member-medical">
          <text class="medical-icon">ğŸ¥</text>
          <text class="medical-text">{{item.medicalHistory}}</text>
        </view>
        <view wx:if="{{item.allergies}}" class="member-allergies">
          <text class="allergy-icon">âš ï¸</text>
          <text class="allergy-text">è¿‡æ•ï¼š{{item.allergies}}</text>
        </view>
      </view>

      <view class="member-actions">
        <button class="action-btn primary" bind:tap="bookForMember" data-member="{{item}}" catch:tap="true">
          é¢„çº¦
        </button>
        <button class="action-btn secondary" bind:tap="editMember" data-member="{{item}}" catch:tap="true">
          ç¼–è¾‘
        </button>
        <button class="action-btn danger" bind:tap="deleteMember" data-id="{{item.id}}" catch:tap="true">
          åˆ é™¤
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{members.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</text>
      <text class="empty-text">æš‚æ— å®¶åº­æˆå‘˜</text>
      <text class="empty-desc">æ·»åŠ å®¶åº­æˆå‘˜ä¿¡æ¯ï¼Œæ–¹ä¾¿ä¸ºä»–ä»¬é¢„çº¦åŒ»ç–—æœåŠ¡</text>
      <button class="empty-action-btn" bind:tap="showAddMemberModal">
        æ·»åŠ ç¬¬ä¸€ä½æˆå‘˜
      </button>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘æˆå‘˜å¼¹çª— -->
  <view wx:if="{{showAddModal}}" class="modal-overlay" bind:tap="hideAddMemberModal">
    <view class="modal-content" catch:tap="true">
      <view class="modal-header">
        <text class="modal-title">{{editingMember.id ? 'ç¼–è¾‘æˆå‘˜' : 'æ·»åŠ æˆå‘˜'}}</text>
        <button class="close-btn" bind:tap="hideAddMemberModal">âœ•</button>
      </view>

      <scroll-view class="modal-body" scroll-y>
        <view class="form-section">
          <text class="section-title">åŸºæœ¬ä¿¡æ¯</text>
          
          <view class="form-item">
            <text class="form-label">å§“å *</text>
            <input class="form-input" placeholder="è¯·è¾“å…¥å§“å" 
                   value="{{editingMember.name}}" bind:input="onMemberInput" data-field="name" />
          </view>

          <view class="form-item">
            <text class="form-label">å…³ç³» *</text>
            <picker range="{{relations}}" range-key="name" value="{{editingMember.relationIndex}}" 
                    bind:change="onRelationChange">
              <view class="picker-item">
                <text>{{editingMember.relation ? getRelationName(editingMember.relation) : 'è¯·é€‰æ‹©å…³ç³»'}}</text>
                <text class="picker-arrow">></text>
              </view>
            </picker>
          </view>

          <view class="form-item">
            <text class="form-label">æ€§åˆ« *</text>
            <picker range="{{genders}}" range-key="name" value="{{editingMember.genderIndex}}" 
                    bind:change="onGenderChange">
              <view class="picker-item">
                <text>{{editingMember.gender ? getGenderName(editingMember.gender) : 'è¯·é€‰æ‹©æ€§åˆ«'}}</text>
                <text class="picker-arrow">></text>
              </view>
            </picker>
          </view>

          <view class="form-item">
            <text class="form-label">å¹´é¾„ *</text>
            <input class="form-input" type="number" placeholder="è¯·è¾“å…¥å¹´é¾„" 
                   value="{{editingMember.age}}" bind:input="onMemberInput" data-field="age" />
          </view>
        </view>

        <view class="form-section">
          <text class="section-title">è”ç³»ä¿¡æ¯</text>
          
          <view class="form-item">
            <text class="form-label">æ‰‹æœºå·</text>
            <input class="form-input" type="number" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
                   value="{{editingMember.phone}}" bind:input="onMemberInput" data-field="phone" />
          </view>

          <view class="form-item">
            <text class="form-label">èº«ä»½è¯å·</text>
            <input class="form-input" placeholder="è¯·è¾“å…¥èº«ä»½è¯å·" 
                   value="{{editingMember.idCard}}" bind:input="onMemberInput" data-field="idCard" />
          </view>
        </view>

        <view class="form-section">
          <text class="section-title">å¥åº·ä¿¡æ¯</text>
          
          <view class="form-item">
            <text class="form-label">æ—¢å¾€ç—…å²</text>
            <textarea class="form-textarea" placeholder="è¯·è¾“å…¥æ—¢å¾€ç—…å²ï¼Œå¦‚é«˜è¡€å‹ã€ç³–å°¿ç—…ç­‰" 
                      value="{{editingMember.medicalHistory}}" bind:input="onMemberInput" data-field="medicalHistory"></textarea>
          </view>

          <view class="form-item">
            <text class="form-label">è¿‡æ•å²</text>
            <textarea class="form-textarea" placeholder="è¯·è¾“å…¥è¿‡æ•å²ï¼Œå¦‚è¯ç‰©è¿‡æ•ã€é£Ÿç‰©è¿‡æ•ç­‰" 
                      value="{{editingMember.allergies}}" bind:input="onMemberInput" data-field="allergies"></textarea>
          </view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="modal-btn secondary" bind:tap="hideAddMemberModal">å–æ¶ˆ</button>
        <button class="modal-btn primary" bind:tap="saveMember">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>