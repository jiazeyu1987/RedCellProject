<!--ç”¨æˆ·è¯¦æƒ…é¡µé¢-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-icon">â³</text>
    <text class="loading-text">åŠ è½½ç”¨æˆ·è¯¦æƒ…ä¸­...</text>
  </view>

  <!-- ç”¨æˆ·è¯¦æƒ… -->
  <view wx:else class="user-detail">
    <!-- ç”¨æˆ·å¤´éƒ¨ä¿¡æ¯ -->
    <view class="user-header">
      <view class="user-basic">
        <view class="user-avatar">
          <text>{{user.avatar}}</text>
        </view>
        <view class="user-info">
          <text class="user-name">{{user.nickname}}</text>
          <text class="real-name">çœŸå®å§“åï¼š{{user.realName}}</text>
          <view class="user-status-line">
            <view class="status-badge status-{{user.status}}">
              <text wx:if="{{user.status === 'active'}}">ğŸŸ¢ æ´»è·ƒ</text>
              <text wx:elif="{{user.status === 'inactive'}}">ğŸ”´ éæ´»è·ƒ</text>
            </view>
            <view class="member-badge {{user.memberLevel === 'vip' ? 'vip' : 'regular'}}">
              <text wx:if="{{user.memberLevel === 'vip'}}">ğŸ‘‘ VIPä¼šå‘˜</text>
              <text wx:else>ğŸ« æ™®é€šä¼šå‘˜</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="action-btn primary" bind:tap="callUser">
          <text class="btn-icon">ğŸ“</text>
          <text>æ‹¨æ‰“ç”µè¯</text>
        </button>
        <button class="action-btn secondary" bind:tap="sendSMS">
          <text class="btn-icon">ğŸ’¬</text>
          <text>å‘é€çŸ­ä¿¡</text>
        </button>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-number">{{user.serviceCount}}</text>
        <text class="stat-label">æœåŠ¡æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">Â¥{{user.totalSpent}}</text>
        <text class="stat-label">æ€»æ¶ˆè´¹</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{addressHistory.length}}</text>
        <text class="stat-label">åœ°å€æ•°é‡</text>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µ -->
    <view class="tab-section">
      <scroll-view class="tab-scroll" scroll-x>
        <view class="tab-list">
          <view wx:for="{{tabs}}" wx:key="id" 
                class="tab-item {{currentTab === item.id ? 'active' : ''}}"
                bind:tap="switchTab" 
                data-tab="{{item.id}}">
            <text class="tab-icon">{{item.icon}}</text>
            <text class="tab-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ ‡ç­¾é¡µå†…å®¹ -->
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view wx:if="{{currentTab === 'basic'}}" class="tab-content">
      <view class="info-section">
        <view class="section-title">ğŸ“ åŸºæœ¬èµ„æ–™</view>
        <view class="info-list">
          <view class="info-item">
            <text class="info-label">æ‰‹æœºå·ç </text>
            <view class="info-value-row">
              <text class="info-value">{{user.phone}}</text>
              <button class="view-btn" bind:tap="viewFullPhone">å®Œæ•´</button>
            </view>
          </view>
          <view class="info-item">
            <text class="info-label">èº«ä»½è¯å·</text>
            <view class="info-value-row">
              <text class="info-value">{{user.idCard}}</text>
              <button class="view-btn" bind:tap="viewFullIdCard">å®Œæ•´</button>
            </view>
          </view>
          <view class="info-item">
            <text class="info-label">é‚®ç®±åœ°å€</text>
            <view class="info-value-row">
              <text class="info-value">{{user.email}}</text>
              <button class="view-btn" bind:tap="viewFullEmail">å®Œæ•´</button>
            </view>
          </view>
          <view class="info-item">
            <text class="info-label">å¹´é¾„</text>
            <text class="info-value">{{user.age}}å²</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ€§åˆ«</text>
            <text class="info-value">{{user.gender}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">ç”Ÿæ—¥</text>
            <text class="info-value">{{user.birthday}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ³¨å†Œæ—¶é—´</text>
            <text class="info-value">{{user.registerTime}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æœ€åè®¿é—®</text>
            <text class="info-value">{{user.lastVisit}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æœ€åç™»å½•IP</text>
            <text class="info-value">{{user.lastLoginIP}}</text>
          </view>
        </view>
      </view>

      <view class="info-section">
        <view class="section-title">ğŸ†˜ ç´§æ€¥è”ç³»äºº</view>
        <view class="info-list">
          <view class="info-item">
            <text class="info-label">è”ç³»äºº</text>
            <text class="info-value">{{user.emergencyContact}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">å…³ç³»</text>
            <text class="info-value">{{user.emergencyRelation}}</text>
          </view>
        </view>
      </view>

      <view class="info-section">
        <view class="section-title">ğŸ“± è®¾å¤‡ä¿¡æ¯</view>
        <view class="info-list">
          <view class="info-item">
            <text class="info-label">è®¾å¤‡å¹³å°</text>
            <text class="info-value">{{user.deviceInfo.platform}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">è®¾å¤‡å‹å·</text>
            <text class="info-value">{{user.deviceInfo.model}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">ç³»ç»Ÿç‰ˆæœ¬</text>
            <text class="info-value">{{user.deviceInfo.version}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åœ°å€ä¿¡æ¯ -->
    <view wx:elif="{{currentTab === 'address'}}" class="tab-content">
      <view class="address-list">
        <view wx:for="{{addressHistory}}" wx:key="id" class="address-card">
          <view class="address-header">
            <view class="address-info">
              <text class="address-text">{{item.address}}</text>
              <view class="address-meta">
                <text class="contact-info">{{item.contactName}} {{item.contactPhone}}</text>
                <view class="address-tags">
                  <text wx:if="{{item.isDefault}}" class="default-tag">é»˜è®¤åœ°å€</text>
                  <text class="visit-tag">{{item.visitCount}}æ¬¡æœåŠ¡</text>
                </view>
              </view>
            </view>
            <button class="nav-btn" bind:tap="navigateToAddress" data-address="{{item}}">
              <text class="nav-icon">ğŸ—ºï¸</text>
              <text>å¯¼èˆª</text>
            </button>
          </view>
          <view class="address-footer">
            <text class="time-info">æœ€åæœåŠ¡ï¼š{{item.lastVisit}}</text>
            <text class="time-info">æ·»åŠ æ—¶é—´ï¼š{{item.addTime}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æœåŠ¡è®°å½• -->
    <view wx:elif="{{currentTab === 'service'}}" class="tab-content">
      <view class="service-list">
        <view wx:for="{{serviceHistory}}" wx:key="id" class="service-card">
          <view class="service-header">
            <view class="service-info">
              <text class="service-name">{{item.serviceName}}</text>
              <text class="service-time">{{item.serviceTime}}</text>
            </view>
            <view class="service-cost">Â¥{{item.cost}}</view>
          </view>
          <view class="service-details">
            <text class="service-nurse">æœåŠ¡äººå‘˜ï¼š{{item.nurse}}</text>
            <text class="service-duration">æœåŠ¡æ—¶é•¿ï¼š{{item.duration}}åˆ†é’Ÿ</text>
            <view class="service-rating">
              <text class="rating-label">ç”¨æˆ·è¯„ä»·ï¼š</text>
              <text class="rating-stars">{'â˜…'.repeat(item.rating)}{'â˜†'.repeat(5-item.rating)}</text>
            </view>
            <text class="service-feedback">ç”¨æˆ·åé¦ˆï¼š{{item.feedback}}</text>
          </view>
          <button class="detail-btn" bind:tap="viewServiceDetail" data-service="{{item}}">
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>

    <!-- å¥åº·æ¡£æ¡ˆ -->
    <view wx:elif="{{currentTab === 'health'}}" class="tab-content">
      <view class="health-section">
        <view class="section-title">â¤ï¸ å¥åº·çŠ¶å†µ</view>
        <view class="health-info">
          <view class="health-item">
            <text class="health-label">æ€»ä½“çŠ¶å†µ</text>
            <text class="health-value good">{{user.healthCondition}}</text>
          </view>
          <view class="health-item">
            <text class="health-label">è¿‡æ•å²</text>
            <text class="health-value warning">{{user.allergies}}</text>
          </view>
          <view class="health-item">
            <text class="health-label">ç—…å²</text>
            <text class="health-value">{{user.medicalHistory}}</text>
          </view>
          <view class="health-item">
            <text class="health-label">åå¥½æœåŠ¡</text>
            <view class="preferred-services">
              <text wx:for="{{user.preferredServices}}" wx:key="*this" class="service-tag">{{item}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç®¡ç†æ“ä½œ -->
    <view class="admin-actions">
      <button class="admin-btn danger" bind:tap="freezeUser">
        <text class="btn-icon">ğŸš«</text>
        <text>å†»ç»“ç”¨æˆ·</text>
      </button>
      <button class="admin-btn primary" bind:tap="exportUserData">
        <text class="btn-icon">ğŸ“¤</text>
        <text>å¯¼å‡ºæ•°æ®</text>
      </button>
    </view>
  </view>
</view>